<%#
  Entity commandbar — matches Salary Book pattern exactly.

  Layout: [ Entity Grid (4 cols × 3 rows) | Divider | Knobs/Filters/Actions | Divider | Global Navigation ]

  The entity grid mirrors how Salary Book shows EAST/WEST teams.
  Each entity type button is same-width, arranged in a grid.

  locals:
  - active_entity_scope: agents|drafts|players|teams|trades|transactions
  - knobs: Array[Hash] — filter groups, each with :label and :options
    - options: Array[Hash] with :type (checkbox|radio), :id, :label, :name, :value, :checked, :bind, :on_change
%>

<%
  active_entity_scope = local_assigns[:active_entity_scope].to_s.strip.presence || "players"
  active_entity_scope = "agents" if active_entity_scope == "agencies"
  active_entity_scope = "drafts" if active_entity_scope == "draft"
  active_entity_scope = "teams" if active_entity_scope == "team"

  knobs = Array(local_assigns[:knobs].presence || local_assigns[:header_knobs])

  # Entity nav links — will be arranged in a 4-col × 3-row grid
  # Row 1: Agents, Drafts, Players, Teams
  # Row 2: Trades, Transactions, (future), (future)
  # Row 3: (future entities)
  nav_links = [
    ["agents", "Agents", "/agents"],
    ["drafts", "Drafts", "/drafts"],
    ["players", "Players", "/players"],
    ["teams", "Teams", "/teams"],
    ["trades", "Trades", "/trades"],
    ["transactions", "Txns", "/transactions"]
  ]
%>

<div id="flash"></div>

<header
  id="commandbar"
  class="sticky top-0 z-50 w-full shrink-0 h-[130px] border-b border-border bg-background flex items-start px-4 pt-3 gap-4 select-none"
>
  <%# Entity Selector Grid — mirrors Salary Book's team grid %>
  <div class="space-y-1" role="navigation" aria-label="Entities">
    <div class="text-[10px] font-semibold uppercase tracking-wider text-muted-foreground/70">Entities</div>
    <div class="grid grid-cols-4 gap-1">
      <% nav_links.each do |scope, label, href| %>
        <% active = scope == active_entity_scope %>
        <a
          href="<%= href %>"
          class="relative h-7 w-20 px-2 rounded text-xs font-medium transition-all duration-150 border outline-none inline-flex items-center justify-center no-underline hover:no-underline <%= active ? 'bg-primary text-primary-foreground border-primary shadow-sm' : 'bg-muted/50 text-foreground border-border hover:bg-muted hover:border-foreground/20' %>"
        ><%= label %></a>
      <% end %>
    </div>
  </div>

  <%# Divider %>
  <div class="h-20 w-px bg-border self-center"></div>

  <%# Filter knobs / actions — page-specific %>
  <% if knobs.any? %>
    <div class="flex items-start gap-4" role="group" aria-label="Filters">
      <% knobs.each_with_index do |group, group_idx| %>
        <% group_label = group[:label].to_s.strip.presence || group["label"].to_s.strip.presence || "Filters" %>
        <% options = Array(group[:options] || group["options"]) %>

        <div class="min-w-[4.5rem] space-y-1">
          <div class="text-[10px] font-semibold uppercase tracking-wider text-muted-foreground/70"><%= group_label %></div>
          <div class="space-y-1">
            <% options.each_with_index do |option, option_idx| %>
              <% option_type = option[:type].to_s == "radio" ? "radio" : "checkbox" %>
              <% option_name = option[:name].to_s.strip.presence || option["name"].to_s.strip.presence || "knob-#{group_idx}" %>
              <% option_label = option[:label].to_s.strip.presence || option["label"].to_s.strip.presence || "Option" %>
              <% option_id = option[:id].to_s.strip.presence || option["id"].to_s.strip.presence || "knob-#{group_idx}-#{option_idx}" %>
              <% option_value = option[:value].to_s %>
              <% option_checked = option.key?(:checked) ? !!option[:checked] : !!option["checked"] %>
              <% option_bind = option[:bind].to_s.strip.presence || option["bind"].to_s.strip.presence %>
              <% option_on_change = option[:on_change].to_s.strip.presence || option["on_change"].to_s.strip.presence %>

              <div class="flex items-center gap-1.5">
                <input
                  type="<%= option_type %>"
                  id="<%= option_id %>"
                  <% if option_type == "radio" %>
                    name="<%= option_name %>"
                    value="<%= option_value %>"
                  <% end %>
                  class="size-3.5 accent-primary"
                  <% if option_checked %>checked<% end %>
                  <% if option_bind.present? %>data-bind="<%= option_bind %>"<% end %>
                  <% if option_on_change.present? %>data-on:change="<%= option_on_change %>"<% end %>
                />
                <label for="<%= option_id %>" class="text-[11px] leading-none cursor-pointer select-none text-foreground/80 hover:text-foreground transition-colors"><%= option_label %></label>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <%# Placeholder when no knobs — keep layout balanced %>
    <div class="flex-1 flex items-center">
      <div class="text-xs text-muted-foreground/50 italic">No filters for this view</div>
    </div>
  <% end %>

  <%# Global navigation + theme controls %>
  <% navigation_destination = case active_entity_scope
     when "drafts" then "draft"
     when "agents", "players", "teams", "trades", "transactions" then active_entity_scope
     else "players"
     end %>
  <div class="h-20 w-px bg-border self-center ml-auto shrink-0"></div>
  <%= render partial: "shared/commandbar_navigation", locals: { active_destination: navigation_destination } %>
</header>
