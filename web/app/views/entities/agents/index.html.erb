<% content_for :title, "Agents" %>

<% query_suffix = @query.present? ? "&q=#{ERB::Util.url_encode(@query)}" : "" %>
<% pane_get_expr = "@get('/agents/pane?kind=' + $entitykind + '&active_only=' + ($activeonly ? '1' : '0') + '#{query_suffix}')" %>
<% update_url_expr = "window.history.replaceState({}, '', '/agents?kind=' + $entitykind + '&active_only=' + ($activeonly ? '1' : '0') + '#{query_suffix}')" %>
<% refresh_expr = "#{pane_get_expr}; #{update_url_expr}" %>
<% sync_agents_expr = "$entitykind = 'agents'; #{refresh_expr}" %>

<div
  id="entity-directory"
  class="min-h-screen w-full bg-background"
  data-signals="{ entitykind: '<%= @directory_kind %>', activeonly: <%= @active_only ? 'true' : 'false' %> }"
>
  <%= render partial: "entities/shared/commandbar", locals: {
    active_entity_scope: "agents",
    on_agents_toggle: sync_agents_expr,
    header_knobs: [
      {
        label: "Directory",
        options: [
          {
            type: "radio",
            name: "entity-kind",
            id: "directory-kind-agents",
            value: "agents",
            label: "Agents",
            checked: @directory_kind == "agents",
            bind: "entitykind",
            on_change: refresh_expr
          },
          {
            type: "radio",
            name: "entity-kind",
            id: "directory-kind-agencies",
            value: "agencies",
            label: "Agencies",
            checked: @directory_kind == "agencies",
            bind: "entitykind",
            on_change: refresh_expr
          }
        ]
      },
      {
        label: "Filters",
        options: [
          {
            type: "checkbox",
            id: "directory-filter-active-only",
            label: "Active only",
            checked: @active_only,
            bind: "activeonly",
            on_change: refresh_expr
          }
        ]
      }
    ]
  } %>

  <main class="px-4 pb-8 space-y-6">
    <%= render partial: "entities/agents/directory_results" %>
  </main>
</div>
