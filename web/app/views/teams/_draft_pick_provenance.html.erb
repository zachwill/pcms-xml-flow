<%#
  Draft Pick Provenance — year-by-year draft asset ownership with visual timeline.

  locals:
  - draft_assets: (Array) rows from draft_pick_summary_assets
  - team_code: (String) current team code
%>

<% assets = Array(local_assigns[:draft_assets]) %>
<% team_code = local_assigns[:team_code].to_s %>

<% years = (2025..2030).to_a %>
<% grouped = assets.group_by { |r| r["draft_year"].to_i } %>

<section class="space-y-4">
  <div class="flex items-center justify-between">
    <h2 class="text-xs font-medium uppercase tracking-wide text-muted-foreground">Draft pick assets</h2>
    <span class="text-xs text-muted-foreground">Showing 2025–2030</span>
  </div>

  <% if assets.empty? %>
    <div class="p-4 rounded-lg bg-muted/30 border border-border/50 text-sm text-muted-foreground italic">No draft asset rows found.</div>
  <% else %>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
      <% years.each do |year| %>
        <% year_assets = grouped[year] || [] %>
        <% r1 = year_assets.select { |r| r["draft_round"].to_i == 1 } %>
        <% r2 = year_assets.select { |r| r["draft_round"].to_i == 2 } %>

        <div class="rounded-lg border border-border bg-background overflow-hidden">
          <div class="bg-muted/50 px-3 py-2 border-b border-border flex items-center justify-between">
            <span class="text-sm font-semibold font-mono"><%= year %></span>
            <% if team_code.present? && year_assets.any? %>
              <span class="text-[10px] text-muted-foreground">
                <%= r1.size %> FRP · <%= r2.size %> SRP
              </span>
            <% end %>
          </div>

          <div class="p-3 space-y-2">
            <%# First round picks %>
            <div class="space-y-1">
              <div class="text-[10px] uppercase tracking-wide text-muted-foreground font-medium">1st Round</div>
              <% if r1.empty? %>
                <div class="text-xs text-muted-foreground/70 italic">None</div>
              <% else %>
                <div class="flex flex-wrap gap-1">
                  <% r1.each do |pick| %>
                    <%= render partial: "teams/pick_pill", locals: { pick: pick, team_code: team_code } %>
                  <% end %>
                </div>
              <% end %>
            </div>

            <%# Second round picks %>
            <div class="space-y-1">
              <div class="text-[10px] uppercase tracking-wide text-muted-foreground font-medium">2nd Round</div>
              <% if r2.empty? %>
                <div class="text-xs text-muted-foreground/70 italic">None</div>
              <% else %>
                <div class="flex flex-wrap gap-1">
                  <% r2.each do |pick| %>
                    <%= render partial: "teams/pick_pill", locals: { pick: pick, team_code: team_code } %>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>

          <% if team_code.present? && year_assets.any? %>
            <div class="px-3 py-2 border-t border-border/50 bg-muted/20">
              <div class="flex gap-2">
                <% [1, 2].each do |round| %>
                  <a
                    href="<%= draft_pick_path(team_code: team_code, year: year, round: round) %>"
                    class="text-[10px] text-muted-foreground hover:text-foreground hover:underline"
                  >R<%= round %> details →</a>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
</section>
