<%# DraftAssetsRow â€” Tailwind port of the React prototype %>

<% picks ||= [] %>
<% salary_years ||= SalaryBookHelper::SALARY_YEARS %>
<% return if picks.empty? %>

<% picks_by_year = picks.group_by { |p| p["year"].to_i } %>

<%# Sort picks within each year (round asc, then origin team code) %>
<% picks_by_year.each_value do |rows| %>
  <% rows.sort_by! { |p| [p["round"].to_i, p["origin_team_code"].to_s] } %>
<% end %>

<% frozen_pick = ->(pick) { (pick["description"].to_s.downcase.include?("frozen")) } %>

<div class="bg-muted/10 dark:bg-muted/5 border-b border-border/50">
  <div class="flex items-start text-xs py-2">
    <%# Sticky label column %>
    <div
      class="w-52 shrink-0 pl-4 sticky left-0 z-[2] bg-muted/10 dark:bg-muted/5 relative
             after:absolute after:right-0 after:top-0 after:bottom-0 after:w-px after:bg-border/30"
    >
      <div class="grid grid-cols-[40px_1fr] items-center h-full">
        <div class="flex items-center justify-start">
          <div class="w-7 h-7 rounded border border-border bg-background flex items-center justify-center text-muted-foreground">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/>
              <path d="M14 2v4a2 2 0 0 0 2 2h4"/>
              <path d="M10 9H8"/>
              <path d="M16 13H8"/>
              <path d="M16 17H8"/>
            </svg>
          </div>
        </div>
        <div class="pl-1 flex items-center gap-2 min-w-0">
          <span class="text-[10px] font-semibold uppercase tracking-wide text-muted-foreground">Draft Assets</span>
          <span class="inline-flex items-center justify-center min-w-[16px] h-4 px-1 rounded-full bg-muted text-muted-foreground text-[9px] font-medium">
            <%= picks.length %>
          </span>
        </div>
      </div>
    </div>

    <%# Year columns %>
    <div class="flex items-start">
      <% salary_years.each do |year| %>
        <% year_picks = picks_by_year[year] || [] %>

        <div class="w-24 shrink-0 flex flex-col items-center gap-1">
          <% if year_picks.any? %>
            <% year_picks.each do |pick| %>
              <% is_frozen = frozen_pick.call(pick) %>
              <% round = pick["round"].to_i %>

              <% status = if is_frozen
                "Frozen"
              elsif pick["is_swap"]
                "Swap"
              elsif pick["is_conditional"] || pick["description"].to_s.downcase.include?("conditional")
                "Conditional"
              else
                round == 1 ? "FRP" : "SRP"
              end %>

              <% label = if ["FRP", "SRP"].include?(status)
                "#{pick['year'].to_i + 1} #{status}"
              else
                status
              end %>

              <% value = pick_value(pick) %>
              <% title = pick_title(pick) %>

              <% card_class = if is_frozen
                "bg-slate-950/90 border border-blue-500/40"
              elsif round == 1
                "bg-amber-200/80 dark:bg-amber-700/70"
              else
                "bg-slate-200/80 dark:bg-slate-700/70"
              end %>

              <% label_class = is_frozen ? "text-blue-200" : "" %>
              <% value_class = is_frozen ? "text-blue-100" : "" %>

              <button
                type="button"
                class="cursor-pointer rounded focus-visible:outline-none focus-visible:ring-0 focus-visible:border-foreground dark:focus-visible:border-foreground"
                data-on:click="evt.stopPropagation(); @get('<%= tools_salary_book_sidebar_pick_path(team: pick['team_code'], year: pick['year'], round: pick['round']) %>')"
              >
                <%= render partial: "tools/salary_book/kpi_cell", locals: {
                  label:,
                  value:,
                  title:,
                  class_name: card_class,
                  label_class_name: "w-full truncate #{label_class}",
                  value_class_name: "truncate #{value_class}"
                } %>
              </button>
            <% end %>
          <% else %>
            <%= render partial: "tools/salary_book/kpi_cell", locals: { value: "â€”", variant: "muted" } %>
          <% end %>
        </div>
      <% end %>

      <%# Total spacer column %>
      <div class="w-24 shrink-0"></div>

      <%# Agent spacer %>
      <div class="w-40 pr-4 shrink-0"></div>
    </div>
  </div>
</div>
