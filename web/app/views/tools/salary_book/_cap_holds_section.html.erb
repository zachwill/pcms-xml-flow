<%# CapHoldsSection — Tailwind port of the React prototype %>

<% cap_holds ||= [] %>
<% salary_years ||= SalaryBookHelper::SALARY_YEARS %>
<% team_code = local_assigns.fetch(:team_code, cap_holds.first&.dig("team_code")) %>
<% return if cap_holds.empty? %>

<div>
  <%# Section header %>
  <div class="bg-muted/10 dark:bg-muted/5 border-b border-border/50">
    <div class="h-8 flex items-center text-xs">
      <div
        class="w-52 shrink-0 pl-4 sticky left-0 z-[2] bg-muted/10 dark:bg-muted/5 relative
               after:absolute after:right-0 after:top-0 after:bottom-0 after:w-px after:bg-border/30"
      >
        <div class="grid grid-cols-[40px_1fr] items-center h-full">
          <div></div>
          <div class="pl-1 flex items-center gap-2 min-w-0">
            <span class="text-[10px] font-semibold uppercase tracking-wide text-muted-foreground">Cap Holds</span>
            <span class="inline-flex items-center justify-center min-w-[16px] h-4 px-1 rounded-full bg-muted text-muted-foreground text-[9px] font-medium">
              <%= cap_holds.length %>
            </span>
          </div>
        </div>
      </div>

      <div class="w-24 shrink-0" data-show="$displayepm"></div>

      <% salary_years.each do |year| %>
        <div
          class="w-24 shrink-0"
          data-class="{ 'bg-yellow-50/70 dark:bg-yellow-900/10': Number($selectedseason) === <%= year %> && $selectedseasonteam === '<%= team_code %>' }"
        ></div>
      <% end %>

      <div class="w-24 shrink-0"></div>
      <div class="w-40 pr-4 shrink-0"></div>
    </div>
  </div>

  <% cap_holds.each do |row| %>
    <% title = row["player_name"].presence || row["amount_type_lk"].presence || "Cap Hold" %>
    <% subtitle = row["amount_type_lk"].present? && row["player_name"].present? ? row["amount_type_lk"] : nil %>

    <div class="border-b border-border/50 hover:bg-muted/30 dark:hover:bg-muted/15 transition-colors">
      <div class="h-8 flex items-center text-xs">
        <%# Sticky label column %>
        <div
          class="w-52 shrink-0 pl-4 sticky left-0 z-[1] bg-background relative
                 after:absolute after:right-0 after:top-0 after:bottom-0 after:w-px after:bg-border/30
                 hover:bg-muted/30 dark:hover:bg-muted/15"
        >
          <div class="grid grid-cols-[40px_1fr] items-center h-full">
            <div></div>
            <div class="pl-1 min-w-0">
              <div class="truncate font-medium text-[12px]"><%= title %></div>
              <% if subtitle %>
                <div class="truncate text-[10px] text-muted-foreground"><%= subtitle %></div>
              <% end %>
            </div>
          </div>
        </div>

        <%# EPM spacer + year columns %>
        <div class="w-24 shrink-0" data-show="$displayepm"></div>

        <% salary_years.each do |year| %>
          <% amt = cap_hold_amount(row, year) %>
          <% is_empty = amt.nil? || amt.to_f == 0 %>
          <div
            class="w-24 shrink-0 font-mono tabular-nums text-center <%= is_empty ? 'text-gray-400/50' : '' %>"
            data-class="{ 'bg-yellow-50/70 dark:bg-yellow-900/10': Number($selectedseason) === <%= year %> && $selectedseasonteam === '<%= team_code %>' }"
          >
            <%= is_empty ? "—" : format_compact_currency(amt) %>
          </div>
        <% end %>

        <div class="w-24 shrink-0"></div>
        <div class="w-40 pr-4 shrink-0"></div>
      </div>
    </div>
  <% end %>
</div>
