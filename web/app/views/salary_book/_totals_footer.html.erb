<%# Totals footer (single-team view) %>

<% salary_years ||= SalaryBookHelper::SALARY_YEARS %>
<% team_summaries ||= {} %>

<div class="!bg-zinc-900 dark:!bg-background border-t border-zinc-700/70 dark:border-border">
  <%# Footer header (season context row) %>
  <div class="h-8 flex items-center border-b border-zinc-700/70 dark:border-border/70 text-xs font-medium text-zinc-400 dark:text-muted-foreground !bg-zinc-900 dark:!bg-background select-none cursor-default">
    <div
      class="w-52 shrink-0 pl-4 sticky left-0 z-[2] self-stretch relative !bg-zinc-900 dark:!bg-background
             after:absolute after:right-0 after:top-0 after:bottom-0 after:w-px after:bg-zinc-700/80 dark:after:bg-border/40"
    >
      <div class="grid grid-cols-[40px_1fr] items-center h-full">
        <div></div>
        <div class="pl-1">Totals</div>
      </div>
    </div>

    <div
      class="h-full flex shrink-0"
      data-on:salarybook-setseason="if (!$seasonlocked) { const nextyear = String(evt.detail.year); if ($selectedseason !== nextyear) { $selectedseason = nextyear; } }"
      data-on:mouseleave="if (!$seasonlocked && $selectedseason !== '') { $selectedseason = ''; }"
      data-on:focusout="if (!$seasonlocked && evt.relatedTarget && !el.contains(evt.relatedTarget) && $selectedseason !== '') { $selectedseason = ''; }"
    >
      <div
        class="w-24 h-full shrink-0 flex items-center justify-center"
        data-show="$displayepm"
        style="display: none;"
      >EPM</div>

      <% salary_years.each do |year| %>
        <div
          class="w-24 h-full shrink-0 flex items-center justify-center tabular-nums text-center transition-colors duration-100 cursor-pointer select-none"
          data-on:mouseenter="el.dispatchEvent(new CustomEvent('salarybook-setseason', { detail: { year: '<%= year %>' }, bubbles: true }))"
          data-on:focusin="el.dispatchEvent(new CustomEvent('salarybook-setseason', { detail: { year: '<%= year %>' }, bubbles: true }))"
          data-on:click="const samecell = ($selectedseason === '<%= year %>'); if (samecell && $seasonlocked) { $seasonlocked = false; $selectedseason = ''; } else { $selectedseason = '<%= year %>'; $seasonlocked = true; }"
          data-class="{ 'bg-yellow-900/20 text-zinc-100 dark:text-foreground': $selectedseason === '<%= year %>' }"
        ><%= format_year_label(year) %></div>
      <% end %>
    </div>

    <div class="w-24 shrink-0"></div>
    <div class="w-40 pr-4 shrink-0"></div>
  </div>

  <%# Roster Cost %>
  <div class="h-12 flex items-center text-xs !bg-zinc-900 dark:!bg-background">
    <div
      class="w-52 shrink-0 pl-4 sticky left-0 z-[2] self-stretch relative !bg-zinc-900 dark:!bg-background
             after:absolute after:right-0 after:top-0 after:bottom-0 after:w-px after:bg-zinc-700/80 dark:after:bg-border/40"
    >
      <div class="grid grid-cols-[40px_1fr] items-center h-full">
        <div class="flex items-center justify-start text-zinc-400 dark:text-muted-foreground">
          <%= lucide_icon("circle-dollar-sign", class: "w-4 h-4", "aria-hidden": true) %>
        </div>
        <div class="pl-1 min-w-0 text-[10px] font-semibold uppercase tracking-wide text-zinc-400 dark:text-muted-foreground">Roster Cost</div>
      </div>
    </div>

    <div class="w-24 shrink-0" data-show="$displayepm" style="display: none;"></div>

    <% salary_years.each do |y| %>
      <% summary = team_summaries[y] %>
      <% cap_total = summary && summary["cap_total"] %>
      <% has_roster_cost = salary_amount_present_for_display?(cap_total) %>
      <div
        class="w-24 shrink-0 flex justify-center"
        data-class="{ 'bg-yellow-900/20': $selectedseason === '<%= y %>' }"
      >
        <%= render partial: "salary_book/kpi_cell", locals: {
          label: format_year_label(y),
          value: has_roster_cost ? format_compact_currency(cap_total) : "—",
          variant: has_roster_cost ? "default" : "muted",
          dark: true
        } %>
      </div>
    <% end %>

    <div class="w-24 shrink-0"></div>
    <div class="w-40 pr-4 shrink-0"></div>
  </div>

  <%# Cap Space %>
  <div class="h-12 flex items-center text-xs !bg-zinc-900 dark:!bg-background">
    <div
      class="w-52 shrink-0 pl-4 sticky left-0 z-[2] self-stretch relative !bg-zinc-900 dark:!bg-background
             after:absolute after:right-0 after:top-0 after:bottom-0 after:w-px after:bg-zinc-700/80 dark:after:bg-border/40"
    >
      <div class="grid grid-cols-[40px_1fr] items-center h-full">
        <div class="flex items-center justify-start text-zinc-400 dark:text-muted-foreground">
          <%= lucide_icon("wallet", class: "w-4 h-4", "aria-hidden": true) %>
        </div>
        <div class="pl-1 min-w-0 text-[10px] font-semibold uppercase tracking-wide text-zinc-400 dark:text-muted-foreground">Cap Space</div>
      </div>
    </div>

    <div class="w-24 shrink-0" data-show="$displayepm" style="display: none;"></div>

    <% salary_years.each do |y| %>
      <% summary = team_summaries[y] %>
      <% cap_space = summary && summary["cap_space"] %>
      <% variant = cap_space.nil? ? "muted" : (cap_space.to_f < 0 ? "negative" : "positive") %>
      <div
        class="w-24 shrink-0 flex justify-center"
        data-class="{ 'bg-yellow-900/20': $selectedseason === '<%= y %>' }"
      >
        <%= render partial: "salary_book/kpi_cell", locals: {
          label: format_year_label(y),
          value: cap_space.nil? ? "—" : format_room_amount(cap_space),
          variant:,
          dark: true
        } %>
      </div>
    <% end %>

    <div class="w-24 shrink-0"></div>
    <div class="w-40 pr-4 shrink-0"></div>
  </div>

  <%# Tax/Apron Status %>
  <div class="h-12 flex items-center text-xs !bg-zinc-900 dark:!bg-background">
    <div
      class="w-52 shrink-0 pl-4 sticky left-0 z-[2] self-stretch relative !bg-zinc-900 dark:!bg-background
             after:absolute after:right-0 after:top-0 after:bottom-0 after:w-px after:bg-zinc-700/80 dark:after:bg-border/40"
    >
      <div class="grid grid-cols-[40px_1fr] items-center h-full">
        <div class="flex items-center justify-start text-zinc-400 dark:text-muted-foreground">
          <%= lucide_icon("shield-alert", class: "w-4 h-4", "aria-hidden": true) %>
        </div>
        <div class="pl-1 min-w-0 text-[10px] font-semibold uppercase tracking-wide text-zinc-400 dark:text-muted-foreground">Tax Status</div>
      </div>
    </div>

    <div class="w-24 shrink-0" data-show="$displayepm" style="display: none;"></div>

    <% salary_years.each do |y| %>
      <% summary = team_summaries[y] %>
      <% status = tax_status(summary) %>
      <div
        class="w-24 shrink-0 flex justify-center"
        data-class="{ 'bg-yellow-900/20': $selectedseason === '<%= y %>' }"
      >
        <%= render partial: "salary_book/kpi_cell", locals: {
          label: status[:label],
          value: status[:value],
          variant: status[:variant],
          dark: true
        } %>
      </div>
    <% end %>

    <div class="w-24 shrink-0"></div>
    <div class="w-40 pr-4 shrink-0"></div>
  </div>

  <%# Luxury Tax Owed %>
  <div class="h-12 flex items-center text-xs !bg-zinc-900 dark:!bg-background" data-show="$displayluxurytax">
    <div
      class="w-52 shrink-0 pl-4 sticky left-0 z-[2] self-stretch relative !bg-zinc-900 dark:!bg-background
             after:absolute after:right-0 after:top-0 after:bottom-0 after:w-px after:bg-zinc-700/80 dark:after:bg-border/40"
    >
      <div class="grid grid-cols-[40px_1fr] items-center h-full">
        <div class="flex items-center justify-start text-zinc-400 dark:text-muted-foreground">
          <%= lucide_icon("chart-column", class: "w-4 h-4", "aria-hidden": true) %>
        </div>
        <div class="pl-1 min-w-0 text-[10px] font-semibold uppercase tracking-wide text-zinc-400 dark:text-muted-foreground">Luxury Tax</div>
      </div>
    </div>

    <div class="w-24 shrink-0" data-show="$displayepm" style="display: none;"></div>

    <% salary_years.each do |y| %>
      <% summary = team_summaries[y] %>
      <% luxury_tax = summary && summary["luxury_tax_owed"] %>
      <% variant = luxury_tax.nil? ? "muted" : (luxury_tax.to_f > 0 ? "negative" : "muted") %>
      <div
        class="w-24 shrink-0 flex justify-center"
        data-class="{ 'bg-yellow-900/20': $selectedseason === '<%= y %>' }"
      >
        <%= render partial: "salary_book/kpi_cell", locals: {
          label: format_year_label(y),
          value: luxury_tax.to_f > 0 ? format_compact_currency(luxury_tax) : "—",
          variant:,
          dark: true
        } %>
      </div>
    <% end %>

    <div class="w-24 shrink-0"></div>
    <div class="w-40 pr-4 shrink-0"></div>
  </div>
</div>
