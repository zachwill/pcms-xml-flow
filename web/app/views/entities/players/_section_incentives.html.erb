<% bonus_rows = Array(@bonus_rows) %>
<% bonus_max_rows = Array(@bonus_max_rows) %>

<section id="incentives" class="space-y-3">
  <h2 class="text-xs font-medium uppercase tracking-wide text-muted-foreground">Incentives</h2>
  <details class="rounded-lg border border-border bg-background p-3" open>
    <summary class="cursor-pointer text-sm font-medium">Bonus rows (<%= bonus_rows.size %>)</summary>
    <div class="mt-3 space-y-3">
      <% if bonus_rows.empty? %>
        <div class="text-sm text-muted-foreground italic">No bonus rows for this contract version.</div>
      <% else %>
        <div class="overflow-x-auto rounded-lg border border-border">
          <table class="entity-table min-w-full text-xs">
            <thead class="bg-muted/40 text-[10px] uppercase tracking-wide text-muted-foreground/90">
              <tr>
                <th class="text-left px-3 py-2 font-medium">Year</th>
                <th class="text-left px-3 py-2 font-medium">Type</th>
                <th class="text-right px-3 py-2 font-medium">Amount</th>
                <th class="text-left px-3 py-2 font-medium">Likelihood</th>
                <th class="text-left px-3 py-2 font-medium">Clause</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-border">
              <% bonus_rows.each do |r| %>
                <tr class="hover:bg-yellow-50/70 dark:hover:bg-yellow-900/10 transition-colors duration-75">
                  <td class="px-3 py-2 font-mono tabular-nums"><%= r["salary_year"] %></td>
                  <td class="px-3 py-2 text-muted-foreground"><%= r["bonus_type_lk"].presence || "—" %></td>
                  <td class="px-3 py-2 text-right font-mono tabular-nums"><%= format_salary(r["bonus_amount"]) %></td>
                  <td class="px-3 py-2">
                    <span class="entity-chip <%= r['is_likely'] ? 'entity-chip--success' : 'entity-chip--warning' %>"><%= r["is_likely"] ? "Likely" : "Unlikely" %></span>
                  </td>
                  <td class="px-3 py-2"><%= r["clause_name"].presence || r["criteria_description"].presence || "—" %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% end %>

      <% if bonus_max_rows.any? %>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs">
          <% bonus_max_rows.each do |r| %>
            <div class="rounded border border-border/60 p-2">
              <span class="font-mono tabular-nums"><%= r["salary_year"] %></span>
              · <span class="text-muted-foreground"><%= r["bonus_type_lk"] %></span>
              · <span class="font-mono tabular-nums"><%= format_salary(r["max_amount"]) %></span>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </details>
</section>
