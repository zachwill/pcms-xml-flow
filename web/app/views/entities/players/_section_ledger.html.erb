<% ledger_entries = Array(@ledger_entries) %>

<section id="ledger" class="space-y-3">
  <h2 class="text-xs font-medium uppercase tracking-wide text-muted-foreground">Ledger timeline</h2>
  <details class="rounded-lg border border-border bg-background p-3" open>
    <summary class="cursor-pointer text-sm font-medium">Recent entries (<%= ledger_entries.size %>)</summary>
    <div class="mt-3">
      <% if ledger_entries.empty? %>
        <div class="text-sm text-muted-foreground italic">No ledger entries found.</div>
      <% else %>
        <div class="overflow-x-auto rounded-lg border border-border">
          <table class="entity-table min-w-full text-xs">
            <thead class="bg-muted/40 text-[10px] uppercase tracking-wide text-muted-foreground/90">
              <tr>
                <th class="text-left px-3 py-2 font-medium">Date</th>
                <th class="text-left px-3 py-2 font-medium">Team</th>
                <th class="text-left px-3 py-2 font-medium">Transaction</th>
                <th class="text-left px-3 py-2 font-medium">Type</th>
                <th class="text-right px-3 py-2 font-medium">Cap Δ</th>
                <th class="text-right px-3 py-2 font-medium">Tax Δ</th>
                <th class="text-right px-3 py-2 font-medium">Apron Δ</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-border">
              <% ledger_entries.first(30).each do |e| %>
                <tr class="hover:bg-yellow-50/70 dark:hover:bg-yellow-900/10 transition-colors duration-75">
                  <td class="px-3 py-2 font-mono tabular-nums"><%= e["ledger_date"] || "—" %></td>
                  <td class="px-3 py-2">
                    <% if e["team_code"].present? %>
                      <a href="<%= team_href(team_code: e['team_code'], team_id: e['team_id']) %>" class="hover:underline"><%= e["team_code"] %></a>
                    <% else %>
                      <span class="text-muted-foreground">—</span>
                    <% end %>
                  </td>
                  <td class="px-3 py-2 font-mono tabular-nums">
                    <% if e["transaction_id"].present? %>
                      <a href="<%= transaction_href(e['transaction_id']) %>" class="hover:underline">#<%= e["transaction_id"] %></a>
                      <% if e["trade_id"].present? %>
                        · <a href="<%= trade_href(e['trade_id']) %>" class="hover:underline">T#<%= e["trade_id"] %></a>
                      <% end %>
                    <% else %>
                      <span class="text-muted-foreground">—</span>
                    <% end %>
                  </td>
                  <td class="px-3 py-2 text-muted-foreground"><%= [e["transaction_type_lk"], e["transaction_description_lk"]].compact.reject(&:blank?).join(" · ").presence || "—" %></td>
                  <td class="px-3 py-2 text-right font-mono tabular-nums"><%= format_salary(e["cap_change"]) %></td>
                  <td class="px-3 py-2 text-right font-mono tabular-nums"><%= format_salary(e["tax_change"]) %></td>
                  <td class="px-3 py-2 text-right font-mono tabular-nums"><%= format_salary(e["apron_change"]) %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
        <% if ledger_entries.size > 30 %>
          <div class="mt-2 text-xs text-muted-foreground italic">Showing first 30 of <%= ledger_entries.size %> rows.</div>
        <% end %>
      <% end %>
    </div>
  </details>
</section>
