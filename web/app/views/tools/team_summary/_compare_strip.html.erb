<%
  slots = [
    { key: "a", label: "Slot A", code: @compare_a_code, row: @compare_a_row, tone: "indigo" },
    { key: "b", label: "Slot B", code: @compare_b_code, row: @compare_b_row, tone: "emerald" }
  ]

  has_compare = slots.any? { |slot| slot[:row].present? }
  both_slots_ready = @compare_a_row.present? && @compare_b_row.present?

  if both_slots_ready
    cap_space_delta = @compare_b_row["cap_space"].to_f - @compare_a_row["cap_space"].to_f
    tax_overage_delta = @compare_b_row["tax_overage"].to_f - @compare_a_row["tax_overage"].to_f
  end
%>

<div id="team-summary-compare-strip" class="border-b border-border/70 bg-muted/20 px-4 py-3 space-y-2">
  <div class="flex items-center justify-between gap-3">
    <div>
      <div class="text-[10px] uppercase tracking-wide font-semibold text-muted-foreground/80">Compare board</div>
      <div class="text-xs text-muted-foreground">Pin two teams and keep drill-in context in the sidebar.</div>
    </div>

    <% if has_compare %>
      <button
        type="button"
        class="cursor-pointer h-7 px-2 rounded border border-border bg-background text-[11px] font-medium hover:bg-muted"
        data-on:click="@get('<%= tools_team_summary_sse_compare_path(@state_params.merge(action: "clear_all")) %>')"
      >Clear compare</button>
    <% end %>
  </div>

  <div class="grid grid-cols-2 gap-2">
    <% slots.each do |slot| %>
      <% row = slot[:row] %>
      <% code = slot[:code] %>
      <% tone = slot[:tone] %>
      <% slot_badge_class = tone == "indigo" ? "text-indigo-700 dark:text-indigo-300 border-indigo-500/40 bg-indigo-500/10" : "text-emerald-700 dark:text-emerald-300 border-emerald-500/40 bg-emerald-500/10" %>

      <div class="rounded border border-border bg-background px-2.5 py-2 space-y-1.5 min-h-[74px]">
        <div class="flex items-center justify-between gap-2">
          <span class="inline-flex items-center rounded border px-1.5 py-0.5 text-[10px] font-semibold uppercase tracking-wide <%= slot_badge_class %>"><%= slot[:label] %></span>

          <% if code.present? %>
            <button
              type="button"
              class="cursor-pointer text-[10px] text-muted-foreground hover:text-foreground hover:underline"
              data-on:click="@get('<%= tools_team_summary_sse_compare_path(@state_params.merge(action: "clear_slot", slot: slot[:key])) %>')"
            >Clear</button>
          <% end %>
        </div>

        <% if row.present? %>
          <% focus_path = tools_team_summary_sidebar_path(team_code: code, **@state_params.merge(selected: code)) %>
          <button
            type="button"
            class="cursor-pointer block w-full text-left"
            data-on:click="$selectedteam = '<%= code %>'; @get('<%= focus_path %>')"
          >
            <div class="text-sm font-medium leading-tight"><%= row["team_name"] %></div>
            <div class="text-[10px] text-muted-foreground/80 tabular-nums"><%= code %> · <%= format_year_label(@selected_year) %></div>
            <div class="mt-1.5 grid grid-cols-2 gap-2 text-[10px] tabular-nums">
              <div>
                <div class="text-muted-foreground/70 uppercase tracking-wide">Cap space</div>
                <div class="font-medium <%= row['cap_space'].to_f >= 0 ? 'text-emerald-600 dark:text-emerald-400' : 'text-red-600 dark:text-red-400' %>"><%= format_room_amount(row["cap_space"]) %></div>
              </div>
              <div>
                <div class="text-muted-foreground/70 uppercase tracking-wide">Tax over</div>
                <div class="font-medium <%= row['tax_overage'].to_f > 0 ? 'text-red-600 dark:text-red-400' : 'text-muted-foreground' %>"><%= row['tax_overage'].to_f > 0 ? format_compact_currency(row["tax_overage"]) : '—' %></div>
              </div>
            </div>
          </button>
        <% else %>
          <div class="text-[11px] text-muted-foreground italic">No team pinned.</div>
        <% end %>
      </div>
    <% end %>
  </div>

  <% if both_slots_ready %>
    <div class="rounded border border-border/60 bg-background px-2.5 py-2 text-[11px] tabular-nums flex flex-wrap items-center gap-3">
      <span class="font-medium text-muted-foreground"><%= @compare_b_code %> vs <%= @compare_a_code %> delta</span>
      <span class="<%= cap_space_delta >= 0 ? 'text-emerald-600 dark:text-emerald-400' : 'text-red-600 dark:text-red-400' %>">Cap Space: <%= format_room_amount(cap_space_delta) %></span>
      <span class="<%= tax_overage_delta <= 0 ? 'text-emerald-600 dark:text-emerald-400' : 'text-red-600 dark:text-red-400' %>">Tax Overage: <%= format_room_amount(tax_overage_delta) %></span>
    </div>
  <% end %>
</div>
