<% rights_by_kind ||= {} %>
<%
  kind_label = ->(kind) {
    case kind.to_s
    when "NBA_DRAFT_RIGHTS"
      "NBA Draft Rights"
    when "DLG_RETURNING_RIGHTS"
      "G League Returning Rights"
    else
      kind.to_s.tr("_", " ").split.map(&:capitalize).join(" ")
    end
  }
%>

<div data-show="$sidebartab === 'rights'" class="border-t border-border pt-4 space-y-3">
  <div class="text-xs font-medium uppercase tracking-wide text-muted-foreground">Rights Snapshot</div>

  <% if rights_by_kind.empty? %>
    <div class="p-3 rounded-lg bg-muted/30 border border-border/50 text-sm text-muted-foreground italic">
      No rights rows for this team in <code>pcms.player_rights_warehouse</code>.
    </div>
  <% else %>
    <% rights_by_kind.keys.sort.each do |kind| %>
      <% rows = rights_by_kind[kind] || [] %>

      <section class="rounded-lg border border-border/60 overflow-hidden">
        <div class="px-3 py-2 bg-muted/20 border-b border-border/60 flex items-center justify-between">
          <div class="text-xs font-medium"><%= kind_label.call(kind) %></div>
          <div class="text-[10px] text-muted-foreground"><%= rows.size %> players</div>
        </div>

        <div class="divide-y divide-border/50">
          <% rows.each do |row| %>
            <% draft_line_parts = [] %>
            <% draft_line_parts << row["draft_year"] if row["draft_year"].present? %>
            <% draft_line_parts << "R#{row['draft_round']}" if row["draft_round"].present? %>
            <% draft_line_parts << "##{row['draft_pick']}" if row["draft_pick"].present? %>
            <% draft_line_parts << "#{row['draft_team_code']}" if row["draft_team_code"].present? %>

            <div class="px-3 py-2">
              <div class="flex items-start justify-between gap-2">
                <a
                  href="<%= player_href(row['player_id']) %>"
                  class="text-sm font-medium hover:underline min-w-0 truncate"
                ><%= row["player_name"].presence || "Player ##{row['player_id']}" %></a>

                <% if row["needs_review"] %>
                  <span class="text-[10px] px-1.5 py-0.5 rounded bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400">review</span>
                <% end %>
              </div>

              <div class="text-[11px] text-muted-foreground mt-0.5">
                <%= draft_line_parts.any? ? draft_line_parts.join(" · ") : "Draft info unavailable" %>
                <% if row["source_trade_id"].present? %>
                  · trade #<%= row["source_trade_id"] %>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </section>
    <% end %>
  <% end %>
</div>
