<% content_for :title, "Agents" %>

<% query_suffix = @query.present? ? "&q=#{ERB::Util.url_encode(@query)}" : "" %>
<% pane_get_expr = "@get('/agents/pane?kind=' + $entitykind + '&active_only=' + ($activeonly ? '1' : '0') + '#{query_suffix}')" %>
<% update_url_expr = "window.history.replaceState({}, '', '/agents?kind=' + $entitykind + '&active_only=' + ($activeonly ? '1' : '0') + '#{query_suffix}')" %>
<% refresh_expr = "#{pane_get_expr}; #{update_url_expr}" %>
<% sync_agents_expr = "$entitykind = 'agents'; #{refresh_expr}" %>

<% root_attrs = "data-signals=\"{ entitykind: '#{@directory_kind}', activeonly: #{@active_only ? 'true' : 'false'} }\"" %>

<%= render partial: "entities/shared/entity_page", locals: {
  root_id: "entity-directory",
  root_attrs: root_attrs,
  main_class: "max-w-5xl mx-auto px-4 pt-3 pb-10 space-y-6",
  commandbar_locals: {
    active_entity_scope: "agents",
    on_agents_toggle: sync_agents_expr,
    container_class: "max-w-5xl mx-auto",
    header_knobs: [
      {
        label: "Directory",
        options: [
          {
            type: "radio",
            name: "entity-kind",
            id: "directory-kind-agents",
            value: "agents",
            label: "Agents",
            checked: @directory_kind == "agents",
            bind: "entitykind",
            on_change: refresh_expr
          },
          {
            type: "radio",
            name: "entity-kind",
            id: "directory-kind-agencies",
            value: "agencies",
            label: "Agencies",
            checked: @directory_kind == "agencies",
            bind: "entitykind",
            on_change: refresh_expr
          }
        ]
      },
      {
        label: "Filters",
        options: [
          {
            type: "checkbox",
            id: "directory-filter-active-only",
            label: "Active only",
            checked: @active_only,
            bind: "activeonly",
            on_change: refresh_expr
          }
        ]
      }
    ]
  }
} do %>
  <%= render partial: "entities/agents/directory_results" %>
<% end %>
