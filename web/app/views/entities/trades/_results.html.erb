<div id="trades-results" class="space-y-3">
  <div class="flex items-end justify-between gap-4">
    <div>
      <h2 class="text-xs font-medium uppercase tracking-wide text-muted-foreground">
        Trades feed ·
        <% case @daterange
           when "today" then %>Today<%
           when "week" then %>This week<%
           when "month" then %>This month<%
           when "season" then %>This season<%
           else %>All dates<%
           end %>
        · <%= @sort_label %>
      </h2>
      <p class="text-[11px] text-muted-foreground mt-1">
        Click a trade row to inspect team-in/team-out anatomy and assets without leaving the list.
        <% if @lens != "all" %>
          <span class="font-medium text-foreground">Lens: <%= @lens_label %></span>
        <% end %>
      </p>
    </div>

    <div class="text-[11px] text-muted-foreground tabular-nums">
      <span><%= @trades.size %> rows</span>
    </div>
  </div>

  <% if @trades.empty? %>
    <div class="p-4 rounded-lg bg-muted/30 border border-border/50 text-sm text-muted-foreground italic">
      No trades found for this time period and filters.
    </div>
  <% else %>
    <div class="overflow-x-auto rounded-lg border border-border">
      <table class="entity-table min-w-full text-xs">
        <thead class="bg-muted/40 text-[10px] uppercase tracking-wide text-muted-foreground/90">
          <tr>
            <th class="text-left px-3 py-2 font-medium">Date</th>
            <th class="text-left px-3 py-2 font-medium">Deal</th>
            <th class="text-left px-3 py-2 font-medium">Teams</th>
            <th class="text-left px-3 py-2 font-medium">Assets</th>
            <th class="text-left px-3 py-2 font-medium">Notes</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-border">
          <% @trades.each do |trade| %>
            <% row_id = trade["trade_id"].to_s %>
            <% open_expr = "$overlaytype = 'trade'; $overlayid = '#{row_id}'; @get('/trades/sidebar/#{row_id}')" %>
            <% teams = trade["teams_involved"].to_s.split(", ").reject(&:blank?) %>
            <tr
              class="group cursor-pointer hover:bg-yellow-50/70 dark:hover:bg-yellow-900/10 transition-colors duration-75"
              data-class="{ 'bg-yellow-100/80 dark:bg-yellow-900/20': $overlaytype === 'trade' && $overlayid === '<%= row_id %>' }"
              data-on:click="<%= open_expr %>"
            >
              <td class="px-3 py-2 align-top">
                <div class="entity-cell-two-line">
                  <div class="entity-cell-primary">
                    <a href="<%= trade_path(trade['trade_id']) %>" class="font-medium font-mono tabular-nums hover:underline" onclick="event.stopPropagation()">
                      <%= trade["trade_date"].present? ? Date.parse(trade["trade_date"].to_s).strftime("%b %d") : "—" %>
                    </a>
                  </div>
                  <div class="entity-cell-secondary">id: <code class="font-mono tabular-nums"><%= trade["trade_id"] %></code></div>
                </div>
              </td>

              <td class="px-3 py-2 align-top">
                <div class="entity-cell-two-line">
                  <div class="entity-cell-primary gap-1.5">
                    <span class="entity-chip entity-chip--muted"><%= trade["team_count"].to_i %> teams</span>
                    <span class="entity-chip entity-chip--warning"><%= trade["complexity_asset_count"].to_i %> assets</span>
                    <% if trade["trade_finalized_date"].present? %>
                      <span class="entity-chip entity-chip--accent">finalized</span>
                    <% end %>
                  </div>
                  <div class="entity-cell-secondary">Trade #<%= trade["trade_id"] %></div>
                </div>
              </td>

              <td class="px-3 py-2 align-top">
                <div class="flex flex-wrap gap-1">
                  <% if teams.any? %>
                    <% teams.each do |code| %>
                      <a href="<%= team_href(team_code: code) %>" class="inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-muted text-foreground hover:bg-muted/80" onclick="event.stopPropagation()"><%= code %></a>
                    <% end %>
                  <% else %>
                    <span class="text-muted-foreground text-[11px]">—</span>
                  <% end %>
                </div>
              </td>

              <td class="px-3 py-2 align-top">
                <div class="entity-cell-two-line">
                  <div class="entity-cell-primary gap-1.5">
                    <span class="entity-chip entity-chip--success"><%= trade["player_count"].to_i %> players</span>
                    <span class="entity-chip entity-chip--accent"><%= trade["pick_count"].to_i %> picks</span>
                  </div>
                  <div class="entity-cell-secondary">
                    <%= trade["cash_line_count"].to_i %> cash lines · <%= trade["tpe_line_count"].to_i %> TPE · <span class="font-mono tabular-nums text-foreground"><%= trade["complexity_asset_count"].to_i %></span> total assets
                  </div>
                </div>
              </td>

              <td class="px-3 py-2 align-top max-w-sm">
                <div class="entity-cell-two-line">
                  <div class="entity-cell-primary text-[11px] truncate"><%= trade["trade_comments"].presence || "—" %></div>
                  <div class="entity-cell-secondary"><%= teams.any? ? teams.join(" · ") : "No team map" %></div>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
</div>
