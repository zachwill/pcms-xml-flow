<% client = client_row %>
<% row_tone_class = local_assigns[:row_tone_class].to_s %>
<% cohort_hint_labels = Array(local_assigns[:cohort_hint_labels]).map(&:to_s).reject(&:blank?) %>

<div class="group transition-colors duration-75 hover:bg-yellow-50/70 dark:hover:bg-yellow-900/10 <%= row_tone_class %>">
  <div class="flex items-center gap-2 px-3 py-1.5 text-xs">
    <div class="min-w-0 flex-[1.3]">
      <div class="grid grid-cols-[28px_1fr] grid-rows-[22px_14px] min-w-0">
        <div class="row-span-2 flex items-center justify-start">
          <div class="size-6 rounded border border-border bg-muted/40 flex items-center justify-center text-[9px] font-semibold uppercase text-muted-foreground">
            <%= client[:player_name].to_s.first(2) %>
          </div>
        </div>

        <div class="h-[22px] flex items-end min-w-0 pl-2">
          <a href="<%= player_href(client[:player_id]) %>" class="truncate font-medium text-[13px] hover:underline group-hover:text-primary transition-colors">
            <%= client[:player_name] %>
          </a>
        </div>

        <div class="h-[14px] -mt-px flex items-start gap-1 min-w-0 pl-2 text-[10px] text-muted-foreground/80 tabular-nums overflow-hidden leading-none">
          <% age_text = client[:age_text].to_s.strip.presence %>
          <% yos_text = client[:yos_text].to_s.strip.presence %>
          <% contract_type_code = client[:contract_type_code].to_s.strip.presence %>
          <% has_detail_tokens = age_text.present? || yos_text.present? || contract_type_code.present? %>

          <% if has_detail_tokens %>
            <div class="flex items-start min-w-0 overflow-hidden whitespace-nowrap">
              <% if age_text.present? %>
                <span class="truncate <%= client[:age_color_class] %>"><%= age_text %></span>
              <% end %>

              <% if yos_text.present? %>
                <% if age_text.present? %>
                  <span class="px-1 text-muted-foreground/50">·</span>
                <% end %>
                <span class="truncate"><%= yos_text %></span>
              <% end %>

              <% if contract_type_code.present? %>
                <% if age_text.present? || yos_text.present? %>
                  <span class="px-1 text-muted-foreground/50">·</span>
                <% end %>
                <span class="truncate"><%= contract_type_code %></span>
              <% end %>
            </div>
          <% else %>
            <span class="text-muted-foreground/50">—</span>
          <% end %>
        </div>
      </div>
    </div>

    <div class="w-14 shrink-0">
      <% if client[:team_code].present? %>
        <a href="<%= team_href(team_code: client[:team_code], team_id: client[:team_id]) %>" class="font-medium hover:underline"><%= client[:team_code] %></a>
      <% else %>
        <span class="text-muted-foreground">—</span>
      <% end %>
    </div>

    <div class="w-24 shrink-0">
      <div class="entity-cell-two-line">
        <div class="entity-cell-primary justify-end font-mono tabular-nums"><%= client[:cap_2025].to_f > 0 ? format_salary(client[:cap_2025]) : "—" %></div>
        <div class="entity-cell-secondary justify-end font-mono tabular-nums"><%= client[:total_salary_from_2025].to_f > 0 ? format_salary(client[:total_salary_from_2025]) : "—" %></div>
      </div>
    </div>

    <div class="w-24 shrink-0">
      <div class="entity-cell-two-line">
        <div class="entity-cell-primary justify-end text-[10px] tabular-nums <%= client[:decision_classes] %>"><%= client[:decision_label] %></div>
        <div class="entity-cell-secondary justify-end text-[10px] tabular-nums"><%= client[:team_name].presence || "—" %></div>
      </div>
    </div>

    <div class="min-w-0 flex-1 flex justify-end">
      <div class="flex flex-col items-end gap-1">
        <% if cohort_hint_labels.any? %>
          <div class="flex flex-wrap justify-end gap-1">
            <% cohort_hint_labels.each do |label| %>
              <span class="entity-chip entity-chip--accent"><%= label %></span>
            <% end %>
          </div>
        <% end %>

        <% if client[:chips].any? %>
          <div class="flex flex-wrap justify-end gap-1">
            <% client[:chips].each do |chip| %>
              <span class="inline-flex items-center px-1.5 py-0.5 rounded-full text-[9px] font-semibold uppercase tracking-wide leading-none <%= chip[:classes] %>"><%= chip[:label] %></span>
            <% end %>
          </div>
        <% else %>
          <span class="text-[10px] text-muted-foreground/50">No active flags</span>
        <% end %>
      </div>
    </div>
  </div>
</div>
