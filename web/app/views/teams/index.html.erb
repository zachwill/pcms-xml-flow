<% content_for :title, "Teams" %>

<%
  overlay_team_active = @selected_team_id.present? && @sidebar_team_row.present?
  selected_team_signal = overlay_team_active ? @selected_team_id.to_s : ""

  signals_literal = "{ teamsquery: #{@query.to_json}, teamsconference: #{@conference_lens.to_json}, teamspressure: #{@pressure_lens.to_json}, teamssort: #{@sort_lens.to_json}, selectedteamid: #{selected_team_signal.to_json}, overlaytype: #{(overlay_team_active ? 'team' : 'none').to_json} }"
%>

<div id="teams-workspace" class="h-screen w-screen flex flex-col overflow-hidden bg-background" data-signals="<%= signals_literal %>">
  <div id="flash"></div>

  <%= render partial: "teams/commandbar" %>

  <div id="viewport" class="flex flex-1 overflow-hidden relative">
    <%= render partial: "teams/workspace_main" %>

    <aside
      id="rightpanel"
      class="w-[30%] min-w-[320px] max-w-[480px] border-l border-border bg-background overflow-hidden relative"
    >
      <div
        id="rightpanel-base-layer"
        class="absolute inset-0 overflow-y-auto overflow-x-hidden overscroll-y-contain scroll-touch pt-2 px-4 pb-4"
      >
        <%= render partial: "teams/rightpanel_base" %>
      </div>

      <% if @sidebar_team_row.present? %>
        <%= render partial: "teams/rightpanel_overlay_team", locals: { team_row: @sidebar_team_row } %>
      <% else %>
        <%= render partial: "teams/rightpanel_clear" %>
      <% end %>
    </aside>
  </div>
</div>

<% content_for :head_scripts do %>
  <script type="module">
    import "teams_index";
  </script>
<% end %>
