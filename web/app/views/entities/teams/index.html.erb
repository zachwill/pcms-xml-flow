<% content_for :title, "Teams" %>

<div id="teams-index" class="h-screen w-screen flex flex-col overflow-hidden bg-background">
  <%= render partial: "entities/shared/commandbar", locals: {
    active_entity_scope: "teams"
  } %>

  <%# Main content area — scrollable master list %>
  <main id="maincanvas" class="flex-1 min-w-0 overflow-y-auto overflow-x-hidden bg-background relative">
    <div class="px-4 py-4">
      <% if @teams.empty? %>
        <div class="p-6 rounded-lg bg-muted/30 border border-border/50 text-sm text-muted-foreground italic text-center">
          No teams found.
        </div>
      <% else %>
        <%# Team list container %>
        <div class="rounded-lg border border-border overflow-hidden">
          <%# Sticky header %>
          <div class="sticky top-0 z-10 bg-muted/70 backdrop-blur-sm border-b border-border">
            <div class="flex items-center px-4 h-8 text-[10px] uppercase tracking-wide text-muted-foreground/90 font-medium">
              <div class="w-20 shrink-0">Code</div>
              <div class="flex-1 min-w-0">Team</div>
              <div class="w-32 shrink-0">Conference</div>
              <div class="w-28 shrink-0">Division</div>
            </div>
          </div>

          <%# Team rows %>
          <div class="divide-y divide-border/50">
            <% @teams.each do |t| %>
              <% code = t["team_code"].to_s %>
              <% team_href_val = team_href(team_code: code, team_id: t["team_id"]) %>

              <div
                class="group cursor-pointer transition-colors duration-75 hover:bg-yellow-50/70 dark:hover:bg-yellow-900/10"
                role="button"
                tabindex="0"
                data-on:click="window.location.href='<%= team_href_val %>'"
                data-on:keydown="if (evt.key === 'Enter' || evt.key === ' ') { evt.preventDefault(); window.location.href='<%= team_href_val %>' }"
              >
                <div class="flex items-center px-4 min-h-[48px]">
                  <%# Code column — double-row grid %>
                  <div class="w-20 shrink-0">
                    <div class="grid grid-cols-[28px_1fr] grid-rows-[24px_16px]">
                      <div class="row-span-2 flex items-center justify-start">
                        <div class="w-6 h-6 rounded border border-border bg-background overflow-hidden flex items-center justify-center">
                          <img
                            src="<%= team_logo_url(t['team_id']) %>"
                            alt="<%= code %>"
                            class="w-full h-full object-contain"
                            loading="lazy"
                            decoding="async"
                            onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                          />
                          <span class="hidden text-[9px] font-mono text-muted-foreground"><%= code %></span>
                        </div>
                      </div>

                      <div class="h-[24px] flex items-end min-w-0 pl-1">
                        <a href="<%= team_href_val %>" class="font-semibold text-[14px] group-hover:text-primary transition-colors" onclick="event.stopPropagation()"><%= code %></a>
                      </div>

                      <div class="h-[16px] -mt-px flex items-start min-w-0 pl-1 leading-none text-[10px] text-muted-foreground/80 tabular-nums">
                        id: <%= t["team_id"] || "—" %>
                      </div>
                    </div>
                  </div>

                  <%# Team name column — double-row grid %>
                  <div class="flex-1 min-w-0 pr-4">
                    <div class="grid grid-rows-[24px_16px]">
                      <div class="h-[24px] flex items-end min-w-0">
                        <a href="<%= team_href_val %>" class="font-medium text-[14px] truncate group-hover:text-primary transition-colors" onclick="event.stopPropagation()"><%= t["team_name"] %></a>
                      </div>
                      <div class="h-[16px] -mt-px flex items-start min-w-0 leading-none text-[10px] text-muted-foreground/80 truncate">
                        <%= t["city"].presence || "—" %>
                      </div>
                    </div>
                  </div>

                  <%# Conference column %>
                  <div class="w-32 shrink-0">
                    <span class="text-sm text-muted-foreground"><%= t["conference_name"] || "—" %></span>
                  </div>

                  <%# Division column %>
                  <div class="w-28 shrink-0">
                    <span class="text-sm text-muted-foreground"><%= t["division_name"] || "—" %></span>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </main>
</div>
