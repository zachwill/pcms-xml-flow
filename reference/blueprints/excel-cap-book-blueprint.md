# Excel Cap Book Blueprint (Sean-style)

**Updated:** 2026-01-31

This is a proposed architecture for a *new* Excel workbook designed for NBA salary cap analysts.

The goal is to preserve Sean's strengths (speed + dense functionality) while eliminating the common failure modes:
- totals that don't reconcile
- silent defaults
- rules that require memorization
- scenarios that can't be explained or reproduced

This blueprint is deliberately "worksheet-first," but it's compatible with a DB-backed model (warehouses + primitives).

---

## Design goals

1. **Ledger trust:** every number is reconcilable.
2. **Scenario = journal:** actions are ordered; state is derived.
3. **Explicit policies:** generated rows are visible and toggleable.
4. **Cockpit UX:** 4-7 stable readouts + alerts + drilldown.
5. **Rules adjacent to controls:** recognition over recall.

---

## Workbook structure (tabs)

### A) Navigation + status

#### `HOME`
- Workbook version + data refresh time
- Active Team/Year/As-of Date/Plan
- "Data health" indicator (Reconciled ✅ / Not reconciled ❌)
- Links to all major tools

---

## The shared Command Bar (repeated everywhere)

Every major sheet reserves the same top strip (same cells) for context + policies.

### Context controls
- Team
- Salary Year (base year)
- As-of Date
- Mode: Cap / Tax / Apron
- Active Plan (Baseline vs Plan)
- Compare Plans (optional): A vs B vs C vs D

### Policy controls (explicit knobs)
- Roster fill target: 0 (off) / 12 / 14 / 15
- Fill type: Rookie min / Vet min / Cheapest
- Incomplete roster charges toggle (if modeled)
- "Show exists-only rows" toggle

**Note on two-way counting:** Two-way counting is a CBA fact, not a policy toggle. Per CBA, two-way contracts count toward cap/tax/apron totals but do NOT count toward the 15-player roster. The cockpit shows informational two-way readouts (count + amount) in the PRIMARY READOUTS section.

**Design rule:** no hidden selectors. No context scattered across the workbook.

---

## B) The cockpit + ledger views

### 1) `TEAM_COCKPIT` (Primary Flight Display)

**Purpose:** at-a-glance truth + alerts.

#### Primary readouts (4-7)
- Cap position (space or over-cap)
- Tax position (room or over-tax)
- Room under Apron 1
- Room under Apron 2
- Roster count (NBA) + (optional) two-way count
- Minimum charges applied? (count + $)
- Estimated luxury tax owed (with repeater flag shown)

#### Alert stack (small, loud)
Examples:
- "Hard-cap triggered by: ____"
- "Trade fails salary match for selected year/mode"
- "Generated fill rows are included (toggle on/off)"
- "Unreconciled ledger vs snapshot: $___"

#### Quick drivers panel
- Top 10 cap hits (selected year)
- Dead money total + top rows
- Holds total + top rows

Links to subsystem sheets + audit.

---

### 2) `ROSTER_GRID` (full roster/ledger view)

**Purpose:** show all rows with explicit "counts vs exists" truth.

#### Required columns
- Row label (player / hold / dead money / generated)
- Bucket: ROST / FA / TERM / 2WAY / GENERATED / EXISTS_ONLY
- CountsTowardTotal? (Y/N)
- CountsTowardRoster? (Y/N)
- Contract/guarantee/option badges
- Trade restriction badges

#### Amount grid
- Multi-year (base year through +5)
- Mode-driven display: cap vs tax vs apron

#### Bottom reconciliation block
- Sum of counting rows by bucket
- Authoritative snapshot totals (same buckets)
- Difference (must be zero; otherwise triggers cockpit alert)

**Note on GENERATED rows:** When `Roster fill target` is set to 12/14/15, the grid includes generated "fill slot" rows with GEN bucket. These are policy assumptions (Ct$=Y, CtR=Y) that count toward totals but are explicitly excluded from the reconciliation check. They appear between DEAD MONEY and EXISTS_ONLY with amber styling.

---

### 3) `BUDGET_LEDGER` (the accounting statement)

**Purpose:** single source of truth for totals and deltas.

Sections:
1. Authoritative snapshot totals (by bucket)
2. Plan deltas (journal actions summarized into buckets)
3. Policy-generated deltas (fill rows, incomplete charges)
4. Derived totals = snapshot + deltas

This is the sheet you use to explain numbers to a GM/owner.

---

## C) Scenario / Plan tooling

### 4) `PLAN_MANAGER`

**Purpose:** manage scenarios and comparisons.

- Plans table: Plan ID, name, notes, created date
- Baseline vs Plan selection
- Compare selectors (A/B/C/D)

**Design rule:** comparison is a first-class workflow.

---

### 5) `PLAN_JOURNAL` (ordered actions)

**Purpose:** the scenario engine.

Journal table columns (conceptually):
- Step # (order)
- Enabled?
- Effective date (default to global as-of date, overridable)
- Action type
- Targets (players, picks, exceptions)
- Parameters (giveback, years, etc.)
- Computed deltas by year (cap/tax/apron)
- Roster adds/drops
- Validation status (OK / Warning / Error)
- Source ("Generated by Trade Lane A", etc.)

Next to the journal: a running-state panel:
- totals after each step
- roster count after each step
- active constraints after each step

---

## D) Subsystem tools (generate journal entries)

### 6) `TRADE_MACHINE` (lane-based)

**Purpose:** rapid trade iteration and side-by-side comparison.

- 4 lanes (A/B/C/D), identical layout
- Inputs: teams, outgoing, incoming, matching mode, year context
- Outputs: outgoing/incoming totals, legality, max incoming, apron gate flags
- Inline reference: salary matching tiers + the "which basis is used" notes

A lane can be "published" into the Plan Journal as one or more steps.

---

### 7) `SIGNINGS_AND_EXCEPTIONS`

**Purpose:** signings, minimums, exceptions, cap room.

Inputs:
- player/slot
- contract structure
- signing method (cap room / exception / minimum)
- effective date

Outputs:
- per-year deltas
- exception usage remaining
- constraint/hard-cap flags

Publish into Plan Journal.

---

### 8) `WAIVE_BUYOUT_STRETCH`

**Purpose:** guided dead money modeling.

Inputs:
- player
- waive date
- give-back
- stretch? set-off assumptions

Outputs:
- cap/tax/apron distribution by year
- immediate savings vs future costs
- rule references shown inline

Publish into Plan Journal.

---

### 9) `ASSETS` (inventory)

Two blocks:
- Exceptions/TPEs: remaining amount, expiration, restrictions, usage in plan
- Picks: ownership grid + encumbrances; plan usage

---

## E) Explainability and correctness

### 10) `AUDIT_AND_RECONCILE`

**Purpose:** prevent "your number is wrong" fights.

Must include:
- totals reconciliation (snapshot vs counting rows vs derived totals)
- contributing rows drilldowns for each headline readout
- assumptions applied (fill rows, toggles, overrides)
- plan diff (baseline vs plan) and journal step summary

---

### 11) `RULES_REFERENCE` (memory aids)

Not a CBA dump - only rules that analysts need while operating:
- salary matching tiers
- apron gates / hard-cap triggers
- minimum salary scales
- rookie scale
- proration helpers

Subsystem sheets should display the relevant rule table adjacent to inputs.

---

## F) Data layer (locked)

### 12) `DATA_*` sheets

Refreshable tables for salaries, holds, dead money, exceptions, picks, system values.

**Design rule:**
- no cross-workbook links
- no hardcoded money logic
- manual overrides must be rare and loudly labeled

---

## What day-to-day usage looks like

1. Start in `TEAM_COCKPIT` (select team/year/date/plan).
2. Build a scenario by adding moves in subsystem sheets:
   - Trade candidate in `TRADE_MACHINE` (Lane A) → publish to journal
   - Waive/stretch in `WAIVE_BUYOUT_STRETCH` → publish
   - Signings in `SIGNINGS_AND_EXCEPTIONS` → publish
3. Return to cockpit to view updated readouts + alerts.
4. If anything is disputed, open `AUDIT_AND_RECONCILE` and show contributing rows + assumptions.

---

## Notes / open design choices

- Whether to model incomplete roster charges explicitly depends on the intended fidelity and the source-of-truth availability.
- If Excel performance becomes an issue, the journal can be implemented as an input table that drives precomputed deltas (rather than recalculating everything row-by-row).
- The key success metric is not "more features." It's: can an analyst *explain* every number quickly and confidently?
