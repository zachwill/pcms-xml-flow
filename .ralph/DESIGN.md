# Design Evolution Backlog (`web/`)

Design-evolution only (no hygiene churn).

North star:
- Entity index pages behave like explorer workbenches (commandbar + maincanvas + rightpanel-base + rightpanel-overlay).
- Fast scan, meaningful knobs, dense interactive rows, and contextual drill-ins.
- Salary Book is the read-only interaction quality bar.
- Team Summary, System Values, and Two-Way Utility continue converging toward stronger workbench UX.

Rubric (1-5):
1) Scan speed
2) Information hierarchy
3) Interaction predictability
4) Density/readability balance
5) Navigation/pivots

## Backlog

- [x] [P1] [INDEX] /agencies (`web/app/views/entities/agencies/index.html.erb`) — open agencies as a first-class explorer workbench (not a redirect detour)
  - Problem: `/agencies` currently routes users through `/agents?kind=agencies`, which weakens orientation and hides agency-specific scanning context.
  - Hypothesis: A dedicated agencies workbench shell with agency-native knobs + overlay drill-ins will reduce navigation friction and improve agency workflow adoption.
  - What changed (files):
    - `web/app/controllers/entities/agencies_controller.rb`
    - `web/app/controllers/entities/agencies_sse_controller.rb`
    - `web/app/views/entities/agencies/index.html.erb`
    - `web/app/views/entities/agencies/_workspace_main.html.erb`
    - `web/app/views/entities/agencies/_rightpanel_base.html.erb`
    - `web/app/views/entities/agencies/_rightpanel_overlay_agency.html.erb`
    - `web/app/views/entities/agencies/_rightpanel_clear.html.erb`
    - `web/config/routes.rb`
    - `web/test/integration/entities_agencies_index_test.rb`
    - Removed: `web/test/integration/entities_agencies_entrypoint_test.rb` (redirect-era coverage)
  - Why this improves the flow:
    - `/agencies` is now a direct workbench shell (`#commandbar`, `#maincanvas`, `#rightpanel-base`, `#rightpanel-overlay`) instead of a detour redirect.
    - Commandbar now exposes agency-native knobs: name search, activity lens, year lens, sort key, and sort direction.
    - Dense agency rows open an in-place overlay with clear canonical pivots (`/agencies/:slug|:id`, `/agents/:slug|:id`, `/players/:slug|:id`).
    - Multi-region knob refreshes are shipped in one ordered SSE response (main + sidebar base + overlay state/signals).
  - Rubric (before → after):
    - Scan speed: 2 → 4
    - Information hierarchy: 2 → 4
    - Interaction predictability: 3 → 4
    - Density/readability: 3 → 4
    - Navigation/pivots: 2 → 4
  - Follow-up tasks discovered:
    - Add explicit “with clients / with restrictions / with expirings” checkbox lenses if agency triage needs tighter pre-filtering.
    - Consider inline quick actions in agency rows (e.g., open top agent overlay) for even faster shortlist workflows.

- [x] [P1] [INDEX] /draft-selections (`web/app/views/entities/draft_selections/index.html.erb`) — find and trace draft selections without leaving the index flow
  - Problem: Draft selections discovery is legacy search-only and not workbench-oriented; provenance inspection requires context switching.
  - Hypothesis: Converging draft selections into a true index workbench (filters + dense rows + sidebar provenance) will speed historical pick investigation.
  - What changed (files):
    - `web/app/controllers/entities/draft_selections_controller.rb`
    - `web/app/controllers/entities/draft_selections_sse_controller.rb`
    - `web/app/views/entities/draft_selections/index.html.erb`
    - `web/app/views/entities/draft_selections/_workspace_main.html.erb`
    - `web/app/views/entities/draft_selections/_rightpanel_base.html.erb`
    - `web/app/views/entities/draft_selections/_rightpanel_overlay_selection.html.erb`
    - `web/app/views/entities/draft_selections/_rightpanel_clear.html.erb`
    - `web/config/routes.rb`
    - `web/test/integration/entities_draft_selections_index_test.rb`
  - Why this improves the flow:
    - `/draft-selections` is now a dedicated workbench shell (`#commandbar`, `#maincanvas`, `#rightpanel-base`, `#rightpanel-overlay`) with URL-backed query/year/round/team knobs.
    - The main table is always scanable (not query-gated) and rows are dense, click-first pivots into an in-place provenance overlay.
    - Sidebar overlays include full provenance rows plus canonical pivots (`/draft-selections/:slug|:id`, `/draft-picks/:team/:year/:round`, `/transactions/:id`, `/trades/:id`, `/players/:slug|:id`, `/teams/:slug|:id`).
    - Filter changes now refresh main + sidebar base + overlay state in one ordered SSE response, preserving the selected overlay when that row remains visible.
  - Rubric (before → after):
    - Scan speed: 1 → 4
    - Information hierarchy: 2 → 4
    - Interaction predictability: 2 → 4
    - Density/readability: 3 → 4
    - Navigation/pivots: 3 → 5
  - Follow-up tasks discovered:
    - Add a sortable lens (e.g., pick order vs most provenance events) for faster anomaly hunting within busy draft years.
    - Consider an optional “include adjacent years” mode to trace late/early draft-window chains without changing pages.

- [ ] [P1] [INDEX] /agents (`web/app/views/entities/agents/index.html.erb`) — jump directly to target agents/agencies while keeping current lens state
  - Problem: Agents workspace lacks a direct search flow; users must rely on sort/filter combinations for known-entity lookup.
  - Hypothesis: Adding a commandbar query knob with SSE refresh + overlay preservation will improve lookup speed without sacrificing density.
  - Scope (files):
    - `web/app/controllers/entities/agents_controller.rb`
    - `web/app/controllers/entities/agents_sse_controller.rb`
    - `web/app/views/entities/agents/index.html.erb`
    - `web/app/views/entities/agents/_workspace_main.html.erb`
    - `web/app/views/entities/agents/_rightpanel_base.html.erb`
    - `web/test/integration/entities_agents_index_test.rb`
  - Acceptance criteria:
    - Commandbar exposes a searchable text input matching agent and agency names.
    - Query changes refresh main + sidebar via one SSE response, with URL query state preserved.
    - If an open overlay entity remains in result set, it stays open; otherwise it clears predictably.
    - Matched lookup flow is usable in both `kind=agents` and `kind=agencies` modes.
  - Rubric (before → target):
    - Scan speed: 3 → 5
    - Information hierarchy: 4 → 4
    - Interaction predictability: 4 → 4
    - Density/readability: 4 → 4
    - Navigation/pivots: 4 → 5
  - Guardrails:
    - Do not modify Salary Book files.

- [ ] [P1] [INDEX] /players (`web/app/views/entities/players/index.html.erb`) — preserve selected player drill-in during iterative filter/sort changes
  - Problem: Players refresh clears overlay state unconditionally, forcing repeated reopen actions during triage.
  - Hypothesis: Preserve-when-visible overlay behavior will make filter iteration faster and more predictable.
  - Scope (files):
    - `web/app/controllers/entities/players_controller.rb`
    - `web/app/controllers/entities/players_sse_controller.rb`
    - `web/app/views/entities/players/_workspace_main.html.erb`
    - `web/app/views/entities/players/_rightpanel_base.html.erb`
    - `web/test/integration/entities_players_index_test.rb`
  - Acceptance criteria:
    - If selected player remains in filtered rows, `#rightpanel-overlay` remains open after refresh.
    - If selected player is filtered out, overlay clears with explicit signal reset.
    - Selected state is visible in both table row and sidebar quick-list entry.
    - Refresh remains one SSE response for main + sidebar regions.
  - Rubric (before → target):
    - Scan speed: 4 → 5
    - Information hierarchy: 4 → 4
    - Interaction predictability: 3 → 5
    - Density/readability: 4 → 4
    - Navigation/pivots: 4 → 5
  - Guardrails:
    - Do not modify Salary Book files.

- [ ] [P1] [INDEX] /teams (`web/app/views/entities/teams/index.html.erb`) — keep team pressure drill-ins stable while tuning conference/pressure knobs
  - Problem: Teams refresh clears selected overlay context, interrupting pressure comparison loops.
  - Hypothesis: Overlay preservation with explicit clear rules will improve continuity for cap-pressure investigation.
  - Scope (files):
    - `web/app/controllers/entities/teams_controller.rb`
    - `web/app/controllers/entities/teams_sse_controller.rb`
    - `web/app/views/entities/teams/_workspace_main.html.erb`
    - `web/app/views/entities/teams/_rightpanel_base.html.erb`
    - `web/test/integration/entities_teams_index_test.rb`
  - Acceptance criteria:
    - Selected team overlay persists through refresh when team remains visible.
    - When filtered out, overlay closes and selected signals reset deterministically.
    - Selected state appears in both main row and pressure-board quick list.
    - Main + sidebar updates still occur via a single ordered SSE response.
  - Rubric (before → target):
    - Scan speed: 4 → 5
    - Information hierarchy: 4 → 4
    - Interaction predictability: 3 → 5
    - Density/readability: 4 → 4
    - Navigation/pivots: 4 → 5
  - Guardrails:
    - Do not modify Salary Book files.

- [ ] [P1] [INDEX] /drafts (`web/app/views/entities/drafts/index.html.erb`) — preserve pick/selection context while adjusting year/team/round knobs
  - Problem: Drafts refresh always clears overlay, breaking pick-provenance tracing during filter iteration.
  - Hypothesis: Preserve-on-compatible-refresh behavior will support faster ownership/provenance analysis.
  - Scope (files):
    - `web/app/controllers/entities/drafts_controller.rb`
    - `web/app/controllers/entities/drafts_sse_controller.rb`
    - `web/app/views/entities/drafts/_results.html.erb`
    - `web/app/views/entities/drafts/_rightpanel_base.html.erb`
    - `web/test/integration/entities_pane_endpoints_test.rb`
  - Acceptance criteria:
    - Selected pick/selection overlay remains open when the selected entity still exists after refresh.
    - Switching to an incompatible view mode (e.g., pick overlay while in selections view) clears overlay explicitly.
    - Selected row/cell styling remains visible after refresh.
    - Refresh response remains one SSE transaction for all updated regions.
  - Rubric (before → target):
    - Scan speed: 4 → 5
    - Information hierarchy: 4 → 4
    - Interaction predictability: 3 → 5
    - Density/readability: 4 → 4
    - Navigation/pivots: 4 → 5
  - Guardrails:
    - Do not modify Salary Book files.

- [ ] [P1] [INDEX] /transactions (`web/app/views/entities/transactions/index.html.erb`) — keep transaction detail open while refining feed filters
  - Problem: Transaction refresh clears detail overlay on every change, slowing triage for multi-step investigations.
  - Hypothesis: Preserve selected transaction when still visible to reduce reopening and context loss.
  - Scope (files):
    - `web/app/controllers/entities/transactions_controller.rb`
    - `web/app/controllers/entities/transactions_sse_controller.rb`
    - `web/app/views/entities/transactions/_results.html.erb`
    - `web/app/views/entities/transactions/_rightpanel_base.html.erb`
    - `web/test/integration/entities_pane_endpoints_test.rb`
  - Acceptance criteria:
    - Selected transaction overlay persists across refresh when row remains in feed.
    - Overlay clears with explicit reset only when filtered row is no longer present.
    - Main feed row + quick-feed button both reflect active selection.
    - Multi-region updates continue to ship as one SSE response.
  - Rubric (before → target):
    - Scan speed: 4 → 5
    - Information hierarchy: 4 → 4
    - Interaction predictability: 3 → 5
    - Density/readability: 4 → 4
    - Navigation/pivots: 4 → 5
  - Guardrails:
    - Do not modify Salary Book files.

- [ ] [P2] [TOOL] /tools/team-summary (`web/app/views/tools/team_summary/show.html.erb`) — make commandbar knob changes patch-driven and state-preserving
  - Problem: Team Summary commandbar currently submits full-page GETs, causing avoidable context resets and uneven state transitions.
  - Hypothesis: A dedicated SSE refresh flow for knobs will keep main table, compare strip, and sidebar synchronized with predictable behavior.
  - Scope (files):
    - `web/app/controllers/tools/team_summary_controller.rb`
    - `web/app/views/tools/team_summary/show.html.erb`
    - `web/app/views/tools/team_summary/_workspace_main.html.erb`
    - `web/app/views/tools/team_summary/_compare_strip.html.erb`
    - `web/app/views/tools/team_summary/_rightpanel_base.html.erb`
    - `web/app/views/tools/team_summary/_rightpanel_overlay_team.html.erb`
    - `web/config/routes.rb`
    - `web/test/integration/tools_team_summary_test.rb`
  - Acceptance criteria:
    - Year/conference/pressure/sort changes trigger one SSE refresh (no full-page reload).
    - SSE refresh patches `#maincanvas`, compare strip, and rightpanel regions in one ordered response.
    - Selected team + compare slots are preserved when still resolvable; otherwise clear deterministically.
    - URL remains shareable and synchronized with current knob state.
  - Rubric (before → target):
    - Scan speed: 4 → 5
    - Information hierarchy: 4 → 5
    - Interaction predictability: 3 → 5
    - Density/readability: 5 → 5
    - Navigation/pivots: 4 → 5
  - Guardrails:
    - Do not modify Salary Book files.

- [ ] [P2] [TOOL] /tools/two-way-utility (`web/app/views/tools/two_way_utility/show.html.erb`) — preserve selected player context while cycling risk/team/conference lenses
  - Problem: Refresh currently clears the player overlay unconditionally, interrupting risk-triage workflows.
  - Hypothesis: Preserve selected player overlay when still in result set to improve rapid compare/triage loops.
  - Scope (files):
    - `web/app/controllers/tools/two_way_utility_controller.rb`
    - `web/app/views/tools/two_way_utility/_player_row.html.erb`
    - `web/app/views/tools/two_way_utility/_rightpanel_base.html.erb`
    - `web/app/views/tools/two_way_utility/_workspace_main.html.erb`
    - `web/test/integration/tools_two_way_utility_test.rb`
  - Acceptance criteria:
    - On refresh, selected player overlay remains open if player still matches current lenses.
    - If no longer visible, overlay is cleared with explicit signal reset.
    - Active selection is visibly synchronized between table row and quick risk queue.
    - Refresh remains one ordered SSE response for all affected regions.
  - Rubric (before → target):
    - Scan speed: 4 → 5
    - Information hierarchy: 4 → 4
    - Interaction predictability: 3 → 5
    - Density/readability: 5 → 5
    - Navigation/pivots: 4 → 5
  - Guardrails:
    - Do not modify Salary Book files.

- [ ] [P2] [TOOL] /tools/system-values (`web/app/views/tools/system_values/show.html.erb`) — extend baseline-delta grammar into Minimum Salary and Rookie Scale sections
  - Problem: Baseline delta treatment is strongest in System/Tax tables; Minimum/Rookie sections still require manual comparison.
  - Hypothesis: Applying consistent delta rows and baseline markers in all sections will improve cross-section scan speed and interpretability.
  - Scope (files):
    - `web/app/controllers/tools/system_values_controller.rb`
    - `web/app/views/tools/system_values/_league_salary_scales_table.html.erb`
    - `web/app/views/tools/system_values/_rookie_scale_amounts_table.html.erb`
    - `web/app/views/tools/system_values/show.html.erb`
    - `web/test/integration/tools_system_values_test.rb`
  - Acceptance criteria:
    - Minimum Salary rows show numeric delta vs selected baseline with consistent color semantics.
    - Rookie Scale rows show numeric delta vs selected baseline with consistent color semantics.
    - Baseline row/selected row labeling remains explicit across all four sections.
    - Integration tests validate minimum + rookie delta rendering.
  - Rubric (before → target):
    - Scan speed: 4 → 5
    - Information hierarchy: 4 → 5
    - Interaction predictability: 4 → 5
    - Density/readability: 4 → 4
    - Navigation/pivots: 4 → 4
  - Guardrails:
    - Do not modify Salary Book files.

- [ ] [P2] [TOOL] /tools/team-summary (`web/app/views/tools/team_summary/_workspace_main.html.erb`) — build compare board directly from dense rows (without sidebar detour)
  - Problem: Pinning compare slots is sidebar-first, adding extra clicks during fast side-by-side setup.
  - Hypothesis: Inline row-level pin actions (A/B) will reduce interaction cost and make compare workflows faster.
  - Scope (files):
    - `web/app/views/tools/team_summary/_workspace_main.html.erb`
    - `web/app/views/tools/team_summary/_compare_strip.html.erb`
    - `web/app/controllers/tools/team_summary_controller.rb`
    - `web/test/integration/tools_team_summary_test.rb`
  - Acceptance criteria:
    - Each row exposes keyboard-accessible `Pin A` / `Pin B` actions.
    - Pin actions update compare strip + sidebar state via one existing compare SSE flow.
    - Row badges and compare strip stay synchronized after pin/replace/clear actions.
    - Dense row layout is preserved (no card conversion).
  - Rubric (before → target):
    - Scan speed: 5 → 5
    - Information hierarchy: 4 → 4
    - Interaction predictability: 4 → 5
    - Density/readability: 5 → 5
    - Navigation/pivots: 4 → 5
  - Guardrails:
    - Do not modify Salary Book files.

- [ ] [P3] [INDEX] /trades (`web/app/views/entities/trades/index.html.erb`) — prioritize high-complexity deals faster with explicit sort/lens controls
  - Problem: Trades feed is date-first only; users cannot quickly surface multi-asset/multi-team complexity patterns.
  - Hypothesis: Adding complexity-oriented sort/lenses will improve first-pass triage speed for trade analysis.
  - Scope (files):
    - `web/app/controllers/entities/trades_controller.rb`
    - `web/app/controllers/entities/trades_sse_controller.rb`
    - `web/app/views/entities/trades/index.html.erb`
    - `web/app/views/entities/trades/_results.html.erb`
    - `web/app/views/entities/trades/_rightpanel_base.html.erb`
    - `web/test/integration/entities_pane_endpoints_test.rb`
  - Acceptance criteria:
    - Commandbar includes a discoverable sort/lens control for complexity (e.g., newest, most teams, most assets).
    - Selecting a lens reorders list and quick-deals sidebar consistently via one SSE refresh.
    - Selected overlay preserve/clear behavior remains deterministic under new sort/lens changes.
    - URL state captures the active sort/lens.
  - Rubric (before → target):
    - Scan speed: 4 → 5
    - Information hierarchy: 4 → 5
    - Interaction predictability: 4 → 5
    - Density/readability: 4 → 4
    - Navigation/pivots: 4 → 5
  - Guardrails:
    - Do not modify Salary Book files.
