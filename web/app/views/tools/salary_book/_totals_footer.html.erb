<%# TotalsFooter — Tailwind port of the React prototype %>

<% salary_years ||= SalaryBookHelper::SALARY_YEARS %>
<% show_tax_aprons = local_assigns.fetch(:show_tax_aprons, true) %>
<% team_code = local_assigns.fetch(:team_code, nil) %>

<% year_label = ->(y) { format_year_label(y) } %>

<div class="bg-zinc-900 dark:bg-zinc-800">
  <%# Roster Cost Row %>
  <div class="h-12 flex items-center text-xs">
    <div
      class="w-52 pl-4 shrink-0 sticky left-0 z-[1] relative bg-zinc-900 dark:bg-zinc-800
             after:absolute after:right-0 after:top-0 after:bottom-0 after:w-px after:bg-zinc-600 dark:after:bg-zinc-500"
    >
      <div class="grid grid-cols-[40px_1fr] items-center h-full">
        <div class="flex items-center justify-start text-zinc-400">
          <span class="font-mono text-sm" aria-hidden="true">Σ</span>
        </div>
        <div class="pl-1 min-w-0 text-[10px] font-semibold uppercase tracking-wide text-zinc-400">Roster Cost</div>
      </div>
    </div>

    <div class="flex items-center">
      <% salary_years.each do |year| %>
        <% summary = team_summaries[year] %>
        <% cap_total = summary&.dig("cap_total") %>
        <div
          class="w-24 shrink-0 flex justify-center"
          data-class="{ 'bg-yellow-50/70 dark:bg-yellow-900/10': Number($selectedseason) === <%= year %> && $selectedseasonteam === '<%= team_code %>' }"
        >
          <%= render partial: "tools/salary_book/kpi_cell", locals: {
            label: year_label.call(year),
            value: cap_total ? format_compact_currency(cap_total) : "—",
            dark: true
          } %>
        </div>
      <% end %>

      <div class="w-24 shrink-0"></div>
      <div class="w-40 pr-4 shrink-0"></div>
    </div>
  </div>

  <%# Cap Space Row %>
  <div class="h-12 flex items-center text-xs">
    <div
      class="w-52 pl-4 shrink-0 sticky left-0 z-[1] relative bg-zinc-900 dark:bg-zinc-800
             after:absolute after:right-0 after:top-0 after:bottom-0 after:w-px after:bg-zinc-600 dark:after:bg-zinc-500"
    >
      <div class="grid grid-cols-[40px_1fr] items-center h-full">
        <div class="flex items-center justify-start text-zinc-400">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"/>
            <path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/>
          </svg>
        </div>
        <div class="pl-1 min-w-0 text-[10px] font-semibold uppercase tracking-wide text-zinc-400">Cap Space</div>
      </div>
    </div>

    <div class="flex items-center">
      <% salary_years.each do |year| %>
        <% summary = team_summaries[year] %>
        <% cap_space = summary&.dig("cap_space") %>
        <% variant = cap_space.nil? ? "muted" : (cap_space.to_f < 0 ? "negative" : "positive") %>
        <div
          class="w-24 shrink-0 flex justify-center"
          data-class="{ 'bg-yellow-50/70 dark:bg-yellow-900/10': Number($selectedseason) === <%= year %> && $selectedseasonteam === '<%= team_code %>' }"
        >
          <%= render partial: "tools/salary_book/kpi_cell", locals: {
            label: year_label.call(year),
            value: cap_space ? format_room_amount(cap_space) : "—",
            variant:,
            dark: true
          } %>
        </div>
      <% end %>

      <div class="w-24 shrink-0"></div>
      <div class="w-40 pr-4 shrink-0"></div>
    </div>
  </div>

  <%# Tax Status Row %>
  <% if show_tax_aprons %>
    <div class="h-12 flex items-center text-xs" data-show="$displaytaxaprons">
      <div
        class="w-52 pl-4 shrink-0 sticky left-0 z-[1] relative bg-zinc-900 dark:bg-zinc-800
               after:absolute after:right-0 after:top-0 after:bottom-0 after:w-px after:bg-zinc-600 dark:after:bg-zinc-500"
      >
        <div class="grid grid-cols-[40px_1fr] items-center h-full">
          <div class="flex items-center justify-start text-zinc-400">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/>
              <path d="M12 8v4"/>
              <path d="M12 16h.01"/>
            </svg>
          </div>
          <div class="pl-1 min-w-0 text-[10px] font-semibold uppercase tracking-wide text-zinc-400">Tax Status</div>
        </div>
      </div>

      <div class="flex items-center">
        <% salary_years.each do |year| %>
          <% summary = team_summaries[year] %>
          <% status = tax_status(summary) %>
          <div
            class="w-24 shrink-0 flex justify-center"
            data-class="{ 'bg-yellow-50/70 dark:bg-yellow-900/10': Number($selectedseason) === <%= year %> && $selectedseasonteam === '<%= team_code %>' }"
          >
            <%= render partial: "tools/salary_book/kpi_cell", locals: {
              label: status[:label],
              value: status[:value],
              variant: status[:variant],
              dark: true
            } %>
          </div>
        <% end %>

        <div class="w-24 shrink-0"></div>
        <div class="w-40 pr-4 shrink-0"></div>
      </div>
    </div>
  <% end %>
</div>
