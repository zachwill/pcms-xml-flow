<% content_for :title, "Liveline" %>

<div
  id="liveline-test"
  class="h-screen w-full flex flex-col overflow-hidden bg-background"
  style="height: 100dvh;"
>
  <div id="flash"></div>

  <header id="commandbar" class="shrink-0 h-[130px] border-b border-border bg-background px-4 pt-3 flex items-start gap-4 select-none overflow-hidden">
    <form data-liveline-controls class="min-w-0 flex-1 space-y-1.5 text-[11px]">
      <div class="grid grid-cols-6 gap-2">
        <label class="space-y-0.5 min-w-0">
          <span class="block text-[10px] uppercase tracking-wide text-muted-foreground/80">Theme</span>
          <select name="theme" class="h-7 w-full rounded border border-border bg-background px-2 text-[11px]">
            <option value="dark" selected>Dark</option>
            <option value="light">Light</option>
          </select>
        </label>

        <label class="space-y-0.5 min-w-0">
          <span class="block text-[10px] uppercase tracking-wide text-muted-foreground/80">Accent</span>
          <input name="color" type="color" value="#3b82f6" class="h-7 w-full rounded border border-border bg-background p-0.5" />
        </label>

        <label class="space-y-0.5 min-w-0">
          <span class="block text-[10px] uppercase tracking-wide text-muted-foreground/80">Momentum</span>
          <select name="momentum" class="h-7 w-full rounded border border-border bg-background px-2 text-[11px]">
            <option value="auto" selected>Auto</option>
            <option value="up">Up</option>
            <option value="down">Down</option>
            <option value="flat">Flat</option>
            <option value="off">Off</option>
          </select>
        </label>

        <label class="space-y-0.5 min-w-0">
          <span class="block text-[10px] uppercase tracking-wide text-muted-foreground/80">Badge</span>
          <select name="badgeVariant" class="h-7 w-full rounded border border-border bg-background px-2 text-[11px]">
            <option value="default" selected>Default</option>
            <option value="minimal">Minimal</option>
          </select>
        </label>

        <label class="space-y-0.5 min-w-0">
          <span class="block text-[10px] uppercase tracking-wide text-muted-foreground/80">Window UI</span>
          <select name="windowStyle" class="h-7 w-full rounded border border-border bg-background px-2 text-[11px]">
            <option value="default" selected>Default</option>
            <option value="rounded">Rounded</option>
            <option value="text">Text</option>
          </select>
        </label>

        <div class="space-y-0.5 min-w-0">
          <div class="flex items-center justify-between text-[10px] uppercase tracking-wide text-muted-foreground/80">
            <span>Lerp speed</span>
            <span data-liveline-lerp-value class="font-mono tabular-nums">0.08</span>
          </div>
          <input
            name="lerpSpeed"
            type="range"
            min="0.02"
            max="0.30"
            step="0.01"
            value="0.08"
            class="w-full accent-primary"
          />
        </div>
      </div>

      <div class="grid grid-cols-6 gap-2 items-start text-[11px]">
        <div class="space-y-0.5 pt-0.5">
          <label class="flex items-center gap-1.5"><input name="grid" type="checkbox" class="size-3.5 accent-primary" checked /> Grid</label>
          <label class="flex items-center gap-1.5"><input name="pulse" type="checkbox" class="size-3.5 accent-primary" checked /> Pulse</label>
        </div>

        <div class="space-y-0.5 pt-0.5">
          <label class="flex items-center gap-1.5"><input name="fill" type="checkbox" class="size-3.5 accent-primary" checked /> Fill</label>
          <label class="flex items-center gap-1.5"><input name="scrub" type="checkbox" class="size-3.5 accent-primary" checked /> Scrub</label>
        </div>

        <div class="space-y-0.5 pt-0.5">
          <label class="flex items-center gap-1.5"><input name="badge" type="checkbox" class="size-3.5 accent-primary" checked /> Badge</label>
          <label class="flex items-center gap-1.5"><input name="showValue" type="checkbox" class="size-3.5 accent-primary" checked /> Value</label>
        </div>

        <div class="space-y-0.5 pt-0.5">
          <label class="flex items-center gap-1.5"><input name="badgeTail" type="checkbox" class="size-3.5 accent-primary" checked /> Tail</label>
          <label class="flex items-center gap-1.5"><input name="valueMomentumColor" type="checkbox" class="size-3.5 accent-primary" /> Value Color</label>
        </div>

        <div class="space-y-0.5 pt-0.5">
          <label class="flex items-center gap-1.5"><input name="orderbook" type="checkbox" class="size-3.5 accent-primary" checked /> Orderbook</label>
          <label class="flex items-center gap-1.5"><input name="exaggerate" type="checkbox" class="size-3.5 accent-primary" /> Exaggerate</label>
        </div>

        <div class="space-y-0.5 pt-0.5">
          <label class="flex items-center gap-1.5"><input name="degen" type="checkbox" class="size-3.5 accent-primary" /> Degen</label>
        </div>
      </div>

    </form>

    <div class="h-20 w-px bg-border self-center ml-auto shrink-0"></div>
    <%= render partial: "shared/commandbar_navigation", locals: { active_destination: "salary_book" } %>
  </header>

  <div id="viewport" class="flex flex-1 overflow-hidden relative">
    <main id="maincanvas" class="flex-1 min-w-0 min-h-0 overflow-hidden bg-background">
      <div id="liveline-test-chart" class="h-full w-full"></div>
    </main>

    <aside
      id="rightpanel"
      class="w-[30%] min-w-[320px] max-w-[480px] border-l border-border bg-background overflow-hidden relative"
    >
      <div
        id="rightpanel-base-layer"
        class="absolute inset-0 overflow-y-auto overflow-x-hidden overscroll-y-contain scroll-touch pt-2 px-4 pb-4"
      >
        <div id="rightpanel-base" class="space-y-4">
          <section class="space-y-1.5">
            <div class="text-[10px] font-semibold uppercase tracking-wider text-muted-foreground/70">Liveline</div>
            <p class="text-xs text-muted-foreground leading-snug">
              Hidden Datastar test harness for validating canvas behavior, interpolation, orderbook lane, and scrub interactions.
            </p>
            <div class="flex flex-wrap items-center gap-1.5 pt-0.5">
              <span class="entity-chip entity-chip--muted">Synthetic feed</span>
              <span class="entity-chip entity-chip--muted">~700ms ticks</span>
              <span class="entity-chip entity-chip--muted">Full-width canvas</span>
            </div>
          </section>

          <section class="border border-border rounded-lg divide-y divide-border">
            <div class="px-3 py-2 flex items-center justify-between gap-3 text-xs">
              <span class="text-muted-foreground uppercase tracking-wide text-[10px]">Latest value</span>
              <span class="font-mono tabular-nums" data-liveline-metric="latest-value">—</span>
            </div>
            <div class="px-3 py-2 flex items-center justify-between gap-3 text-xs">
              <span class="text-muted-foreground uppercase tracking-wide text-[10px]">Latest tick</span>
              <span class="font-mono tabular-nums" data-liveline-metric="latest-time">—</span>
            </div>
            <div class="px-3 py-2 flex items-center justify-between gap-3 text-xs">
              <span class="text-muted-foreground uppercase tracking-wide text-[10px]">Window</span>
              <span class="font-mono tabular-nums" data-liveline-metric="window">—</span>
            </div>
            <div class="px-3 py-2 flex items-center justify-between gap-3 text-xs">
              <span class="text-muted-foreground uppercase tracking-wide text-[10px]">Point count</span>
              <span class="font-mono tabular-nums" data-liveline-metric="points">—</span>
            </div>
            <div class="px-3 py-2 flex items-center justify-between gap-3 text-xs">
              <span class="text-muted-foreground uppercase tracking-wide text-[10px]">Momentum</span>
              <span class="font-mono tabular-nums" data-liveline-metric="momentum">—</span>
            </div>
          </section>

          <section class="border border-border rounded-lg divide-y divide-border">
            <div class="px-3 py-2 text-[10px] font-semibold uppercase tracking-wider text-muted-foreground/70">Hover probe</div>
            <div class="px-3 py-2 flex items-center justify-between gap-3 text-xs">
              <span class="text-muted-foreground uppercase tracking-wide text-[10px]">Hover value</span>
              <span class="font-mono tabular-nums" data-liveline-metric="hover-value">—</span>
            </div>
            <div class="px-3 py-2 flex items-center justify-between gap-3 text-xs">
              <span class="text-muted-foreground uppercase tracking-wide text-[10px]">Hover time</span>
              <span class="font-mono tabular-nums" data-liveline-metric="hover-time">—</span>
            </div>
          </section>

          <section class="border border-border rounded-lg p-3 space-y-1.5">
            <div class="text-[10px] font-semibold uppercase tracking-wider text-muted-foreground/70">Notes</div>
            <ul class="text-[11px] text-muted-foreground space-y-1 list-disc pl-4">
              <li>Window selector remains on-canvas for direct feel checks.</li>
              <li>Controls are command-bar native to match tool ergonomics.</li>
              <li>Theme follows global Dark Mode toggle.</li>
            </ul>
          </section>
        </div>
      </div>

      <div id="rightpanel-overlay"></div>
    </aside>
  </div>
</div>

<% content_for :head_scripts do %>
  <script type="module">
    import "liveline_test";
  </script>
<% end %>
