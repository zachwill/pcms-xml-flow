<% content_for :title, "System Values" %>

<div
  id="system-values"
  class="h-screen w-screen flex flex-col overflow-hidden bg-background"
  data-signals="{ showsystemvalues: true, showtaxrates: true, showsalaryscales: true, showrookiescales: true }"
>
  <header id="commandbar" class="shrink-0 border-b border-border bg-background h-[130px] px-4 pt-3 flex items-start gap-4 select-none">
    <div class="flex-1 min-w-0 space-y-3">
      <div>
        <h1 class="text-sm font-semibold tracking-wide uppercase">System Values</h1>
        <p class="text-[11px] text-muted-foreground">League constants, tax brackets, salary scales, rookie scale grid</p>
      </div>

      <form method="get" action="<%= tools_system_values_path %>" class="flex flex-wrap items-end gap-3" role="group" aria-label="System Values controls">
        <div class="space-y-1">
          <label class="block text-[10px] font-semibold uppercase tracking-wider text-muted-foreground/70">Season</label>
          <select name="year" class="h-7 rounded border border-border bg-muted/50 px-2 text-xs">
            <% @available_years.each do |candidate_year| %>
              <option value="<%= candidate_year %>" <%= "selected" if candidate_year == @selected_year %>><%= format_year_label(candidate_year) %></option>
            <% end %>
          </select>
        </div>

        <div class="space-y-1">
          <label class="block text-[10px] font-semibold uppercase tracking-wider text-muted-foreground/70">From</label>
          <select name="from_year" class="h-7 rounded border border-border bg-muted/50 px-2 text-xs font-mono tabular-nums">
            <% @available_years.each do |candidate_year| %>
              <option value="<%= candidate_year %>" <%= "selected" if candidate_year == @from_year %>><%= candidate_year %></option>
            <% end %>
          </select>
        </div>

        <div class="space-y-1">
          <label class="block text-[10px] font-semibold uppercase tracking-wider text-muted-foreground/70">To</label>
          <select name="to_year" class="h-7 rounded border border-border bg-muted/50 px-2 text-xs font-mono tabular-nums">
            <% @available_years.each do |candidate_year| %>
              <option value="<%= candidate_year %>" <%= "selected" if candidate_year == @to_year %>><%= candidate_year %></option>
            <% end %>
          </select>
        </div>

        <button type="submit" class="h-7 px-2 rounded border border-border bg-muted/50 text-xs font-medium hover:bg-muted">Apply</button>

        <div class="h-7 w-px bg-border self-end mx-1"></div>

        <div class="space-y-1">
          <div class="text-[10px] font-semibold uppercase tracking-wider text-muted-foreground/70">Visible sections</div>
          <div class="flex flex-wrap items-center gap-3">
            <label class="flex items-center gap-1.5 text-[11px] text-foreground/80">
              <input type="checkbox" class="size-3.5 accent-primary" data-bind="showsystemvalues" />
              System
            </label>
            <label class="flex items-center gap-1.5 text-[11px] text-foreground/80">
              <input type="checkbox" class="size-3.5 accent-primary" data-bind="showtaxrates" />
              Tax Rates
            </label>
            <label class="flex items-center gap-1.5 text-[11px] text-foreground/80">
              <input type="checkbox" class="size-3.5 accent-primary" data-bind="showsalaryscales" />
              Minimum Salary
            </label>
            <label class="flex items-center gap-1.5 text-[11px] text-foreground/80">
              <input type="checkbox" class="size-3.5 accent-primary" data-bind="showrookiescales" />
              Rookie Scale
            </label>
          </div>
        </div>
      </form>
    </div>

    <div class="h-20 w-px bg-border self-center ml-auto shrink-0"></div>
    <%= render partial: "shared/commandbar_navigation", locals: { active_destination: "system_values" } %>
  </header>

  <main class="flex-1 min-h-0 overflow-y-auto overflow-x-hidden pb-8">
    <% if @boot_error %>
      <div class="p-4">
        <div class="p-4 rounded-lg border border-border bg-muted/20">
          <div class="text-sm font-medium text-destructive">Warehouse query failed</div>
          <pre class="mt-2 text-xs text-muted-foreground overflow-x-auto"><%= @boot_error %></pre>
        </div>
      </div>
    <% else %>
      <div class="divide-y divide-border/60">
        <%= render partial: "tools/system_values/league_system_values_table", locals: {
          rows: @league_system_values,
          selected_year: @selected_year
        } %>

        <%= render partial: "tools/system_values/league_tax_rates_table", locals: {
          rows: @league_tax_rates,
          selected_year: @selected_year
        } %>

        <%= render partial: "tools/system_values/league_salary_scales_table", locals: {
          rows: @league_salary_scales,
          selected_year: @selected_year
        } %>

        <%= render partial: "tools/system_values/rookie_scale_amounts_table", locals: {
          rows: @rookie_scale_amounts,
          selected_year: @selected_year
        } %>
      </div>
    <% end %>
  </main>
</div>
